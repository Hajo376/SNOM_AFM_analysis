<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SNOM_AFM_analysis.lib.get_directionality &#8212; SNOM/AFM Analysis 1.0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="../../../_static/basic.css?v=686e5160" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css?v=27fed22d" />
    <script src="../../../_static/documentation_options.js?v=8d563738"></script>
    <script src="../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for SNOM_AFM_analysis.lib.get_directionality</h1><div class="highlight"><pre>
<span></span><span class="sd">&#39;&#39;&#39;This script is ment to extract the directionality from a measurement of a chiral coupler.&#39;&#39;&#39;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.optimize</span><span class="w"> </span><span class="kn">import</span> <span class="n">curve_fit</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mpl_toolkits.axes_grid1</span><span class="w"> </span><span class="kn">import</span> <span class="n">make_axes_locatable</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy</span><span class="w"> </span><span class="kn">import</span> <span class="n">signal</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pathlib</span>
<span class="n">this_files_path</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">tkinter</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">tk</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tkinter</span><span class="w"> </span><span class="kn">import</span> <span class="n">filedialog</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">SNOM_AFM_analysis.lib.snom_colormaps</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>

<div class="viewcode-block" id="ChiralCoupler">
<a class="viewcode-back" href="../../../SNOM_AFM_analysis.lib.html#SNOM_AFM_analysis.lib.get_directionality.ChiralCoupler">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ChiralCoupler</span><span class="p">():</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">height_data</span><span class="p">,</span> <span class="n">data_array</span><span class="p">,</span> <span class="n">channels</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height_data</span> <span class="o">=</span> <span class="n">height_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_array</span> <span class="o">=</span> <span class="n">data_array</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">channels</span> <span class="o">=</span> <span class="n">channels</span>
        <span class="c1"># self.integ_width = integ_width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orientation</span> <span class="o">=</span> <span class="n">orientation</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">wg_positions</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># if &#39;A&#39; in channel:</span>
        <span class="c1">#     self.display_channel = &#39;A&#39;</span>
        <span class="c1"># elif &#39;P&#39; in channel:</span>
        <span class="c1">#     self.display_channel = &#39;P&#39;</span>
        <span class="c1"># self.display_channel = </span>
        <span class="c1"># data used for displaying with the fit to the waveguides, typically the height profile is shown as this is the basis for the fits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">height_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Fit_Wgs</span><span class="p">()</span>

<div class="viewcode-block" id="ChiralCoupler.Fit_Wgs">
<a class="viewcode-back" href="../../../SNOM_AFM_analysis.lib.html#SNOM_AFM_analysis.lib.get_directionality.ChiralCoupler.Fit_Wgs">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Fit_Wgs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;This fits the data and returns a list with both positions of the waveguides.</span>
<span class="sd">        Like: [row, col_wg1, col_wg2]</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">orientation</span> <span class="o">==</span> <span class="s1">&#39;vertical&#39;</span><span class="p">:</span>
            <span class="n">width</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height_data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="p">(</span><span class="n">width</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span> <span class="p">(</span><span class="n">width</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="o">*</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">bounds</span> <span class="o">=</span> <span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1000</span><span class="p">],</span> <span class="p">[</span><span class="mi">1000</span><span class="p">,</span> <span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1000</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">list_of_coefficients</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;starting the fitting procedure&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height_data</span><span class="p">)):</span>
                <span class="n">coeff</span><span class="p">,</span> <span class="n">var_matrix</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">Double_Gauss</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">width</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">height_data</span><span class="p">[</span><span class="n">row</span><span class="p">],</span> <span class="n">p0</span><span class="o">=</span><span class="n">p0</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">list_of_coefficients</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coeff</span><span class="p">)</span>
                <span class="n">p0</span> <span class="o">=</span> <span class="n">coeff</span> <span class="c1">#set the starting parameters for the next fit</span>
                <span class="c1"># print(coeff)</span>
            <span class="n">mean_sigma</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">list_of_coefficients</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_of_coefficients</span><span class="p">))]</span>
            <span class="n">mean_sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">mean_sigma</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">integ_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">mean_sigma</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Get_Integration_Width</span><span class="p">()</span></div>


<div class="viewcode-block" id="ChiralCoupler.Get_Integration_Width">
<a class="viewcode-back" href="../../../SNOM_AFM_analysis.lib.html#SNOM_AFM_analysis.lib.get_directionality.ChiralCoupler.Get_Integration_Width">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Get_Integration_Width</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Plot_Data_With_Fit_And_Bounds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height_data</span><span class="p">,</span> <span class="s1">&#39;Z&#39;</span><span class="p">)</span>
        <span class="n">user_input</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Do you like the extraction width? Current width is </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">integ_width</span><span class="si">}</span><span class="s1"> y/n: &#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">user_input</span> <span class="o">==</span> <span class="s1">&#39;n&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">integ_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Please enter the new extraction width as an integer: &#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Get_Integration_Width</span><span class="p">()</span> <span class="c1"># call recursively until user is happy with integ_width</span>
        <span class="k">elif</span> <span class="n">user_input</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Please enter n or y!&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="ChiralCoupler.Plot_Data_With_Fit_And_Bounds">
<a class="viewcode-back" href="../../../SNOM_AFM_analysis.lib.html#SNOM_AFM_analysis.lib.get_directionality.ChiralCoupler.Plot_Data_With_Fit_And_Bounds">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Plot_Data_With_Fit_And_Bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">channel</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>    
        <span class="c1"># fig.set_figheight(self.figsizey)</span>
        <span class="c1"># fig.set_figwidth(self.figsizex) </span>
        
        <span class="n">yres</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;Z&#39;</span> <span class="ow">in</span> <span class="n">channel</span><span class="p">:</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;gray&#39;</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;height [nm]&#39;</span>
            <span class="n">axis</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">list_of_coefficients</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">yres</span><span class="p">)],</span> <span class="nb">range</span><span class="p">(</span><span class="n">yres</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
            <span class="n">axis</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">list_of_coefficients</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">yres</span><span class="p">)],</span> <span class="nb">range</span><span class="p">(</span><span class="n">yres</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s1">&#39;A&#39;</span> <span class="ow">in</span> <span class="n">channel</span><span class="p">:</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="n">SNOM_amplitude</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;amplitude [a.u.]&#39;</span>
        <span class="k">elif</span> <span class="s1">&#39;P&#39;</span> <span class="ow">in</span> <span class="n">channel</span><span class="p">:</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="n">SNOM_phase</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;phase&#39;</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
        <span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
        <span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;5%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
        <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">)</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_yaxis</span><span class="p">()</span><span class="o">.</span><span class="n">labelpad</span> <span class="o">=</span> <span class="mi">15</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">270</span><span class="p">)</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;finding the wgs&#39;</span><span class="p">)</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;scaled&#39;</span><span class="p">)</span>
        <span class="c1"># left wg extraction bounds</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">list_of_coefficients</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">integ_width</span><span class="o">-</span><span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">yres</span><span class="p">)],</span> <span class="nb">range</span><span class="p">(</span><span class="n">yres</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">list_of_coefficients</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">integ_width</span><span class="o">+</span><span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">yres</span><span class="p">)],</span> <span class="nb">range</span><span class="p">(</span><span class="n">yres</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
        <span class="c1"># right wg extraction bounds</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">list_of_coefficients</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">integ_width</span><span class="o">-</span><span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">yres</span><span class="p">)],</span> <span class="nb">range</span><span class="p">(</span><span class="n">yres</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">list_of_coefficients</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">integ_width</span><span class="o">+</span><span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">yres</span><span class="p">)],</span> <span class="nb">range</span><span class="p">(</span><span class="n">yres</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="ChiralCoupler.Extract_WG_Data">
<a class="viewcode-back" href="../../../SNOM_AFM_analysis.lib.html#SNOM_AFM_analysis.lib.get_directionality.ChiralCoupler.Extract_WG_Data">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Extract_WG_Data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel</span><span class="p">):</span>
        <span class="n">wg_positions</span> <span class="o">=</span> <span class="p">[[</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_of_coefficients</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_of_coefficients</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height_data</span><span class="p">))]</span>
        <span class="c1"># print(&#39;wg_positions&#39;, wg_positions)</span>
        <span class="c1"># print(&#39;integ_width: &#39;, integ_width)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">left_wg_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">right_wg_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wg_positions</span><span class="p">)):</span>
            <span class="n">wg_left</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">wg_positions</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">wg_right</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">wg_positions</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">left_wg_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_array</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">channel</span><span class="p">)][</span><span class="n">row</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">wg_left</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">integ_width</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="n">wg_left</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">integ_width</span><span class="p">)])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">right_wg_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_array</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">channel</span><span class="p">)][</span><span class="n">row</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">wg_right</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">integ_width</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="n">wg_right</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">integ_width</span><span class="p">)])</span></div>

    
<div class="viewcode-block" id="ChiralCoupler.Data_Mean">
<a class="viewcode-back" href="../../../SNOM_AFM_analysis.lib.html#SNOM_AFM_analysis.lib.get_directionality.ChiralCoupler.Data_Mean">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Data_Mean</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="n">mean_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Extract_WG_Data</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>
            <span class="n">left_mean_array</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">right_mean_array</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_array</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">channel</span><span class="p">)])):</span>
                <span class="n">sum_left</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">sum_right</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">amp_left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_wg_data</span><span class="p">[</span><span class="n">row</span><span class="p">]</span>
                <span class="n">amp_right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_wg_data</span><span class="p">[</span><span class="n">row</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">integ_width</span><span class="p">):</span>
                    <span class="n">sum_left</span><span class="o">+=</span><span class="n">amp_left</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                    <span class="n">sum_right</span><span class="o">+=</span><span class="n">amp_right</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="n">left_mean_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sum_left</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">integ_width</span><span class="p">)</span>
                <span class="n">right_mean_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sum_right</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">integ_width</span><span class="p">)</span>
            <span class="n">mean_data</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">channel</span><span class="p">,</span> <span class="n">left_mean_array</span><span class="p">,</span> <span class="n">right_mean_array</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">mean_data</span></div>

    
<div class="viewcode-block" id="ChiralCoupler.Export_Mean_Data">
<a class="viewcode-back" href="../../../SNOM_AFM_analysis.lib.html#SNOM_AFM_analysis.lib.get_directionality.ChiralCoupler.Export_Mean_Data">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Export_Mean_Data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="n">mean_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Data_Mean</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mean_data</span><span class="p">)):</span>
            <span class="n">channel</span> <span class="o">=</span> <span class="n">mean_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Export_Data</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">mean_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">mean_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span></div>



<div class="viewcode-block" id="ChiralCoupler.Integrate_Amplitude">
<a class="viewcode-back" href="../../../SNOM_AFM_analysis.lib.html#SNOM_AFM_analysis.lib.get_directionality.ChiralCoupler.Integrate_Amplitude">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Integrate_Amplitude</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">channel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Plot_Data_With_Fit_And_Bounds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_array</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">channel</span><span class="p">)],</span> <span class="n">channel</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;This channel (</span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s1">) is not in memory!&#39;</span><span class="p">)</span>
            <span class="n">exit</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">Extract_WG_Data</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">amp_left_integ_array</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">amp_right_integ_array</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_array</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">channel</span><span class="p">)])):</span>
            <span class="n">sum_left</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">sum_right</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">amp_left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_wg_data</span><span class="p">[</span><span class="n">row</span><span class="p">]</span>
            <span class="n">amp_right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_wg_data</span><span class="p">[</span><span class="n">row</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">integ_width</span><span class="p">):</span>
                <span class="n">sum_left</span><span class="o">+=</span><span class="n">amp_left</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="n">sum_right</span><span class="o">+=</span><span class="n">amp_right</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="c1"># print(&#39;sum_left:&#39;, sum_left)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">amp_left_integ_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sum_left</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">amp_right_integ_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sum_right</span><span class="p">)</span>
        <span class="c1"># print(&#39;len(data[0])&#39;, len(data[0]))</span>
        <span class="c1"># print(&#39;len(self.amp_left_integ_array)&#39;, len(self.amp_left_integ_array))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">amp_left_integ_array</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">amp_left_integ_array</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;left wg&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">amp_right_integ_array</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">amp_right_integ_array</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;right wg&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="ChiralCoupler.Display_Phase_Profile">
<a class="viewcode-back" href="../../../SNOM_AFM_analysis.lib.html#SNOM_AFM_analysis.lib.get_directionality.ChiralCoupler.Display_Phase_Profile">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Display_Phase_Profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">channel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Plot_Data_With_Fit_And_Bounds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_array</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">channel</span><span class="p">)],</span> <span class="n">channel</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;This channel (</span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s1">) is not in memory!&#39;</span><span class="p">)</span>
            <span class="n">exit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Extract_WG_Data</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phase_left_integ_array</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phase_right_integ_array</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_array</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">channel</span><span class="p">)])):</span>
            <span class="n">sum_left</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">sum_right</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">phase_left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_wg_data</span><span class="p">[</span><span class="n">row</span><span class="p">]</span>
            <span class="n">phase_right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_wg_data</span><span class="p">[</span><span class="n">row</span><span class="p">]</span>
            <span class="n">N</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">integ_width</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
                <span class="n">sum_left</span><span class="o">+=</span><span class="n">phase_left</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="n">sum_right</span><span class="o">+=</span><span class="n">phase_right</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="c1"># print(&#39;sum_left:&#39;, sum_left)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phase_left_integ_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sum_left</span><span class="o">/</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phase_right_integ_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sum_right</span><span class="o">/</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>
        <span class="c1"># print(&#39;len(data[0])&#39;, len(data[0]))</span>
        <span class="c1"># print(&#39;len(phase_left_integ_array)&#39;, len(phase_left_integ_array))</span>
        <span class="c1"># plt.plot(range(len(phase_left_integ_array)), phase_left_integ_array, label=&#39;left wg&#39;)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_right_integ_array</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase_right_integ_array</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;right wg&#39;</span><span class="p">)</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        coeff = self.Fit_Sawtooth(phase_right_integ_array)</span>
<span class="sd">        # x = range(len(phase_left_integ_array))</span>
<span class="sd">        x = np.linspace(0, 1, 500)</span>
<span class="sd">        plt.plot(x*len(phase_left_integ_array), Sawtooth_v2(x, coeff[0], coeff[1]), label=&#39;Fit to right wg&#39;)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">flattened_profile</span> <span class="o">=</span> <span class="n">Flatten_Profile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_right_integ_array</span><span class="p">)</span>
        <span class="n">coeff</span> <span class="o">=</span> <span class="n">Fit_Linear_Function</span><span class="p">(</span><span class="n">flattened_profile</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_right_integ_array</span><span class="p">)),</span> <span class="n">flattened_profile</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;flattened phase&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_right_integ_array</span><span class="p">)),</span> <span class="n">Linear_Function</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_right_integ_array</span><span class="p">)),</span> <span class="n">coeff</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coeff</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;fit: flattened phase&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


    <span class="c1"># def __Export_File(self, filepath, filename, data):</span>
    <span class="c1">#     data = open(filename + filename, &#39;w&#39;)</span>


<div class="viewcode-block" id="ChiralCoupler.Export_Data">
<a class="viewcode-back" href="../../../SNOM_AFM_analysis.lib.html#SNOM_AFM_analysis.lib.get_directionality.ChiralCoupler.Export_Data">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Export_Data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">left_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">right_data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">this_files_path</span><span class="p">,</span> <span class="s1">&#39;../chiralcouplers_analysis/extracted_data&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="s1">&#39;A&#39;</span> <span class="ow">in</span> <span class="n">channel</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">left_data</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
                <span class="n">left_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">amp_left_integ_array</span>
            <span class="k">if</span> <span class="n">right_data</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
                <span class="n">right_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">amp_right_integ_array</span>
            <span class="n">filename_extension</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s1">_mean.txt&#39;</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">filename</span> <span class="o">+</span> <span class="n">filename_extension</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">datafile</span><span class="p">:</span>
                <span class="n">datafile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#pixel</span><span class="se">\t</span><span class="s1">amp leftwg</span><span class="se">\t</span><span class="s1">amp rightwg</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">amp_left_integ_array</span><span class="p">)):</span>
                    <span class="n">datafile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">amp_left_integ_array</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">amp_right_integ_array</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="c1"># with open(filepath + &#39;/&#39; + f&#39;right_wg_integ_{channel}.txt&#39;, &#39;w&#39;) as datafile:</span>
            <span class="c1">#     datafile.write(&#39;#pixel\tamp&#39;)</span>
            <span class="c1">#     for i in range(len(self.amp_right_integ_array)):</span>
            <span class="c1">#         datafile.write(f&#39;{i}\t{self.amp_right_integ_array[i]}\n&#39;)</span>
        <span class="k">elif</span> <span class="s1">&#39;P&#39;</span> <span class="ow">in</span> <span class="n">channel</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">left_data</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
                <span class="n">left_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase_left_integ_array</span>
            <span class="k">if</span> <span class="n">right_data</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
                <span class="n">right_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase_right_integ_array</span>
            <span class="n">filename_extension</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s1">_mean.txt&#39;</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">filename</span> <span class="o">+</span> <span class="n">filename_extension</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">datafile</span><span class="p">:</span>
                <span class="n">datafile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#pixel</span><span class="se">\t</span><span class="s1">phase leftwg</span><span class="se">\t</span><span class="s1">phase rightwg&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_left_integ_array</span><span class="p">)):</span>
                    <span class="n">datafile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_left_integ_array</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_right_integ_array</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></div>

            <span class="c1"># with open(filepath + &#39;/&#39; + f&#39;right_wg_integ_{channel}.txt&#39;, &#39;w&#39;) as datafile:</span>
            <span class="c1">#     datafile.write(&#39;#pixel\tamp&#39;)</span>
            <span class="c1">#     for i in range(len(self.phase_right_integ_array)):</span>
            <span class="c1">#         datafile.write(f&#39;{i}\t{self.amp_right_integ_array[i]}\n&#39;)</span>

<div class="viewcode-block" id="ChiralCoupler.Display_Phase_Difference">
<a class="viewcode-back" href="../../../SNOM_AFM_analysis.lib.html#SNOM_AFM_analysis.lib.get_directionality.ChiralCoupler.Display_Phase_Difference">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Display_Phase_Difference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">channel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Plot_Data_With_Fit_And_Bounds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_array</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">channel</span><span class="p">)],</span> <span class="n">channel</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;This channel (</span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s1">) is not in memory!&#39;</span><span class="p">)</span>
            <span class="n">exit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Extract_WG_Data</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>
        <span class="n">phase_left_integ_array</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">phase_right_integ_array</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">phase_difference</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">left_wg_data</span><span class="p">)):</span>
            <span class="n">sum_left</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">sum_right</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">phase_left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_wg_data</span><span class="p">[</span><span class="n">row</span><span class="p">]</span>
            <span class="n">phase_right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_wg_data</span><span class="p">[</span><span class="n">row</span><span class="p">]</span>
            <span class="n">N</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">integ_width</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
                <span class="n">sum_left</span><span class="o">+=</span><span class="n">phase_left</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="n">sum_right</span><span class="o">+=</span><span class="n">phase_right</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="c1"># print(&#39;sum_left:&#39;, sum_left)</span>
            <span class="n">phase_left_integ_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sum_left</span><span class="o">/</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>
            <span class="n">phase_right_integ_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sum_right</span><span class="o">/</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>
            <span class="c1"># phase_difference.append(Get_Smallest_Difference(sum_left/(N), sum_right/(N)))</span>
            <span class="n">phase_difference</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Get_Phase_Difference_V2</span><span class="p">(</span><span class="n">sum_left</span><span class="o">/</span><span class="p">(</span><span class="n">N</span><span class="p">),</span> <span class="n">sum_right</span><span class="o">/</span><span class="p">(</span><span class="n">N</span><span class="p">)))</span>

        <span class="c1"># extend the phase range by adding copy shifted down by 2 pi</span>
        <span class="n">extended_phase_difference</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">phase</span> <span class="ow">in</span> <span class="n">phase_difference</span><span class="p">:</span>
            <span class="n">extended_phase_difference</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">phase</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">phase</span> <span class="o">&gt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">:</span>
                <span class="n">extended_phase_difference</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">phase</span><span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">phase_difference</span><span class="p">)),</span> <span class="n">phase_difference</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;phase difference&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

        
        <span class="c1"># plt.plot(range(len(extended_phase_difference)), extended_phase_difference, &#39;x&#39;, label=&#39;extended phase difference&#39;)</span>
        <span class="c1"># plt.title(f&#39;{channel}&#39;)</span>
        <span class="c1"># plt.legend()</span>
        <span class="c1"># plt.show()</span>

<div class="viewcode-block" id="ChiralCoupler.Fit_Sawtooth">
<a class="viewcode-back" href="../../../SNOM_AFM_analysis.lib.html#SNOM_AFM_analysis.lib.get_directionality.ChiralCoupler.Fit_Sawtooth">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Fit_Sawtooth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
        <span class="n">n_periods</span><span class="o">=</span><span class="mi">8</span>
        <span class="n">period</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">/</span><span class="n">n_periods</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="p">[</span><span class="n">n_periods</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">100</span><span class="p">],</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">])</span>
        <span class="n">coeff</span><span class="p">,</span> <span class="n">var_matrix</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">Sawtooth_v2</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="n">p0</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Fit of Sawtooth successful!&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">coeff</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">coeff</span></div>
</div>

        <span class="c1"># x = range(len(data))</span>
        <span class="c1"># p0 = [2*np.pi/len(data), 8, 0]</span>
        <span class="c1"># bounds = ([1*np.pi/len(data), 1, -2*np.pi/len(data)], [4*np.pi/len(data), 100, 2*np.pi/len(data)])</span>
        <span class="c1"># coeff, var_matrix = curve_fit(Sawtooth, x, data, p0=p0, bounds=bounds)</span>
        <span class="c1"># print(&#39;Fit of Sawtooth successful!&#39;)</span>
        <span class="c1"># print(coeff)</span>
        <span class="c1"># return coeff</span>
        <span class="c1"># plt.plot(x, Sawtooth(x, coeff[0], coeff[1], coeff[2]))</span>
        <span class="c1"># #plot a sawtooth</span>
        <span class="c1"># period = 2 * np.pi /len(phase_left_integ_array)</span>
        <span class="c1"># # period = len(phase_left_integ_array)/8</span>
        <span class="c1"># n_periods = 8</span>
        <span class="c1"># offset = 17</span>
        <span class="c1"># phase_orientation = 1</span>
        <span class="c1"># t = np.linspace(0, len(phase_left_integ_array), 1000)</span>
        <span class="c1"># # t = np.arange(len(phase_left_integ_array))</span>
        <span class="c1"># plt.plot(t, np.pi*(1+signal.sawtooth(period * n_periods * (t-offset), phase_orientation)))</span>

<div class="viewcode-block" id="Flatten_Profile">
<a class="viewcode-back" href="../../../SNOM_AFM_analysis.lib.html#SNOM_AFM_analysis.lib.get_directionality.Flatten_Profile">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">Flatten_Profile</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">threshold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mf">0.8</span>
    <span class="n">flattened_profile</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">phase_shift</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">threshold</span><span class="p">):</span>
            <span class="n">phase_shift</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mi">2</span>
        <span class="n">flattened_profile</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">phase_shift</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">flattened_profile</span></div>


<div class="viewcode-block" id="Fit_Decaying_Amplitude">
<a class="viewcode-back" href="../../../SNOM_AFM_analysis.lib.html#SNOM_AFM_analysis.lib.get_directionality.Fit_Decaying_Amplitude">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">Fit_Decaying_Amplitude</span><span class="p">():</span>
    <span class="n">with_oscillation</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">scaling</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">pixelsize</span> <span class="o">=</span> <span class="mi">50</span><span class="o">/</span><span class="n">scaling</span> <span class="c1"># in nm</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Tk</span><span class="p">()</span>
    <span class="n">root</span><span class="o">.</span><span class="n">withdraw</span><span class="p">()</span>
    <span class="n">filepath</span> <span class="o">=</span> <span class="n">filedialog</span><span class="o">.</span><span class="n">askopenfilename</span><span class="p">(</span><span class="n">initialdir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">this_files_path</span><span class="p">,</span> <span class="s1">&#39;../chiralcouplers_analysis/extracted_data&#39;</span><span class="p">)))</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">skip_header</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">leftwg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">skip_header</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">rightwg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">skip_header</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="c1"># data = np.loadtxt(f, delimiter=&#39;\t&#39;, skip_header=1)</span>
    <span class="c1"># print(&#39;x: &#39;, x)</span>
    <span class="c1"># print(&#39;leftwg: &#39;, leftwg)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">pixelsize</span><span class="o">*</span><span class="mf">0.001</span><span class="p">,</span><span class="n">leftwg</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;leftwg&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:blue&#39;</span><span class="p">)</span> <span class="c1"># convert pixels to distance in m</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">pixelsize</span><span class="o">*</span><span class="mf">0.001</span><span class="p">,</span><span class="n">rightwg</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;rightwg&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:orange&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">with_oscillation</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.29</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">]</span>
        <span class="c1"># bounds = ([0, -100], [100, 100])</span>
        <span class="n">coeff_leftwg</span><span class="p">,</span> <span class="n">var_matrix</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">Damped_Exponenial_Function</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">leftwg</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="n">p0</span><span class="p">)</span>
        <span class="n">coeff_rightwg</span><span class="p">,</span> <span class="n">var_matrix</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">Damped_Exponenial_Function</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">leftwg</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="n">p0</span><span class="p">)</span>
        <span class="c1"># plt.plot(x, Damped_Oscillation_Function(x, 0.1, 0.29, 0, 0.04)+Exponenial_Function(x, 0.2, 0.01, 0))</span>
        <span class="c1"># plt.plot(x, Damped_Exponenial_Function(x, 0.2, 50, 0.1, 0.29, 0, 0.04), label=&#39;initial_guess&#39;)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Damped_Exponenial_Function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">coeff_leftwg</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coeff_leftwg</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">coeff_leftwg</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">coeff_leftwg</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">coeff_leftwg</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">coeff_leftwg</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;fit_leftwg&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:blue&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Damped_Exponenial_Function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">coeff_rightwg</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coeff_rightwg</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">coeff_rightwg</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">coeff_rightwg</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">coeff_rightwg</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">coeff_rightwg</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;fit_rightwg&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:orange&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;oscillation period leftwg = &#39;</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">coeff_leftwg</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span><span class="o">*</span><span class="n">coeff_leftwg</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span><span class="o">*</span><span class="n">pixelsize</span><span class="p">,</span> <span class="s1">&#39; nm&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;oscillation period rightwg = &#39;</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">coeff_rightwg</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span><span class="o">*</span><span class="n">coeff_rightwg</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span><span class="o">*</span><span class="n">pixelsize</span><span class="p">,</span> <span class="s1">&#39; nm&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">50</span><span class="o">*</span><span class="n">scaling</span><span class="p">]</span>
        <span class="n">coeff_leftwg</span><span class="p">,</span> <span class="n">var_matrix</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">Exponenial_Function</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">leftwg</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="n">p0</span><span class="p">)</span>
        <span class="n">coeff_rightwg</span><span class="p">,</span> <span class="n">var_matrix</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">Exponenial_Function</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">rightwg</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="n">p0</span><span class="p">)</span>
        <span class="c1"># plt.plot(x,leftwg, label=&#39;leftwg&#39;, color=&#39;tab:blue&#39;)</span>
        <span class="c1"># plt.plot(x,rightwg, label=&#39;rightwg&#39;, color=&#39;tab:orange&#39;)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">pixelsize</span><span class="o">*</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">Exponenial_Function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">coeff_leftwg</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coeff_leftwg</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;fit_leftwg&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:blue&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">pixelsize</span><span class="o">*</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">Exponenial_Function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">coeff_rightwg</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coeff_rightwg</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;fit_rightwg&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:orange&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;propagation length leftwg = &#39;</span><span class="p">,</span> <span class="n">coeff_leftwg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">pixelsize</span><span class="p">,</span> <span class="s1">&#39; nm&#39;</span><span class="p">)</span> 
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;propagation length rightwg = &#39;</span><span class="p">,</span> <span class="n">coeff_rightwg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">pixelsize</span><span class="p">,</span> <span class="s1">&#39; nm&#39;</span><span class="p">)</span> 
    <span class="c1"># print(coeff)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$x \ [m]$&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$abs(E_z) \ [a.u.]$&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="Damped_Exponenial_Function">
<a class="viewcode-back" href="../../../SNOM_AFM_analysis.lib.html#SNOM_AFM_analysis.lib.get_directionality.Damped_Exponenial_Function">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">Damped_Exponenial_Function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">omega_0</span><span class="p">,</span> <span class="n">phase</span><span class="p">,</span> <span class="n">gamma</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Exponenial_Function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span><span class="o">+</span><span class="n">Damped_Oscillation_Function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">omega_0</span><span class="p">,</span> <span class="n">phase</span><span class="p">,</span> <span class="n">gamma</span><span class="p">)</span></div>


<div class="viewcode-block" id="Exponenial_Function">
<a class="viewcode-back" href="../../../SNOM_AFM_analysis.lib.html#SNOM_AFM_analysis.lib.get_directionality.Exponenial_Function">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">Exponenial_Function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">A</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">d</span><span class="p">))</span> <span class="c1"># this is for the electric field, for intensity the /2 should be removed</span></div>




<div class="viewcode-block" id="Damped_Oscillation_Function">
<a class="viewcode-back" href="../../../SNOM_AFM_analysis.lib.html#SNOM_AFM_analysis.lib.get_directionality.Damped_Oscillation_Function">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">Damped_Oscillation_Function</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">omega_0</span><span class="p">,</span> <span class="n">phase</span><span class="p">,</span> <span class="n">gamma</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Damped oscillation function</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        A [float]: amplitude of the oscillation</span>
<span class="sd">        period [float]: period of oscillation </span>
<span class="sd">        phase [float]: initial phase of the oscillation</span>
<span class="sd">        gamma [float]: damping factor of the oscillation</span>
<span class="sd">    </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">A</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">gamma</span><span class="o">*</span><span class="n">omega_0</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">gamma</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">omega_0</span><span class="o">*</span><span class="n">t</span> <span class="o">+</span> <span class="n">phase</span><span class="p">)</span></div>


<div class="viewcode-block" id="Fit_Linear_Function">
<a class="viewcode-back" href="../../../SNOM_AFM_analysis.lib.html#SNOM_AFM_analysis.lib.get_directionality.Fit_Linear_Function">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">Fit_Linear_Function</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">p0</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">bounds</span> <span class="o">=</span> <span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">100</span><span class="p">],</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">])</span>
    <span class="n">coeff</span><span class="p">,</span> <span class="n">var_matrix</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">Linear_Function</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)),</span> <span class="n">data</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="n">p0</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">coeff</span></div>


<div class="viewcode-block" id="Linear_Function">
<a class="viewcode-back" href="../../../SNOM_AFM_analysis.lib.html#SNOM_AFM_analysis.lib.get_directionality.Linear_Function">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">Linear_Function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span><span class="o">*</span><span class="n">x</span><span class="o">+</span><span class="n">b</span></div>


<div class="viewcode-block" id="Double_Gauss">
<a class="viewcode-back" href="../../../SNOM_AFM_analysis.lib.html#SNOM_AFM_analysis.lib.get_directionality.Double_Gauss">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">Double_Gauss</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">mu_1</span><span class="p">,</span> <span class="n">mu_2</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">A</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">mu_1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">mu_2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span> <span class="o">+</span> <span class="n">offset</span></div>


<div class="viewcode-block" id="Sawtooth_v2">
<a class="viewcode-back" href="../../../SNOM_AFM_analysis.lib.html#SNOM_AFM_analysis.lib.get_directionality.Sawtooth_v2">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">Sawtooth_v2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n_periods</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
    <span class="n">phase_orientation</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">signal</span><span class="o">.</span><span class="n">sawtooth</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">n_periods</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">offset</span><span class="p">),</span> <span class="n">phase_orientation</span><span class="p">))</span></div>


<div class="viewcode-block" id="Sawtooth">
<a class="viewcode-back" href="../../../SNOM_AFM_analysis.lib.html#SNOM_AFM_analysis.lib.get_directionality.Sawtooth">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">Sawtooth</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">n_periods</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
    <span class="n">phase_orientation</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">signal</span><span class="o">.</span><span class="n">sawtooth</span><span class="p">(</span><span class="n">period</span> <span class="o">*</span> <span class="n">n_periods</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">offset</span><span class="p">),</span> <span class="n">phase_orientation</span><span class="p">))</span></div>



<div class="viewcode-block" id="Get_Smallest_Difference">
<a class="viewcode-back" href="../../../SNOM_AFM_analysis.lib.html#SNOM_AFM_analysis.lib.get_directionality.Get_Smallest_Difference">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">Get_Smallest_Difference</span><span class="p">(</span><span class="n">value1</span><span class="p">,</span> <span class="n">value2</span><span class="p">):</span>
    <span class="c1"># make shure value1 is smaller than value2</span>
    <span class="n">orientation</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">value1</span> <span class="o">&gt;</span> <span class="n">value2</span><span class="p">:</span>
        <span class="n">copy</span> <span class="o">=</span> <span class="n">value1</span>
        <span class="n">value1</span> <span class="o">=</span> <span class="n">value2</span>
        <span class="n">value2</span> <span class="o">=</span> <span class="n">copy</span>
        <span class="c1"># orientation = -1</span>
    <span class="n">difference</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">value1</span> <span class="o">-</span> <span class="n">value2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">difference</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">:</span>
        <span class="n">difference</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mi">2</span> <span class="o">-</span> <span class="n">difference</span>
    <span class="k">return</span> <span class="n">difference</span><span class="o">*</span><span class="n">orientation</span></div>


<div class="viewcode-block" id="Get_Phase_Difference_V2">
<a class="viewcode-back" href="../../../SNOM_AFM_analysis.lib.html#SNOM_AFM_analysis.lib.get_directionality.Get_Phase_Difference_V2">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">Get_Phase_Difference_V2</span><span class="p">(</span><span class="n">value1</span><span class="p">,</span> <span class="n">value2</span><span class="p">):</span>
    <span class="n">sign</span> <span class="o">=</span> <span class="o">+</span><span class="mi">1</span>
    <span class="k">if</span> <span class="n">value1</span> <span class="o">&gt;</span> <span class="n">value2</span><span class="p">:</span>
        <span class="n">copy</span> <span class="o">=</span> <span class="n">value1</span>
        <span class="n">value1</span> <span class="o">=</span> <span class="n">value2</span>
        <span class="n">value2</span> <span class="o">=</span> <span class="n">copy</span>
        <span class="c1"># sign = -1</span>
    <span class="n">diff1</span> <span class="o">=</span> <span class="n">value2</span><span class="o">-</span><span class="n">value1</span>
    <span class="n">diff2</span> <span class="o">=</span> <span class="n">value1</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">-</span><span class="n">value2</span>
    
    <span class="c1"># if abs(diff1) &lt;= abs(diff2):</span>
    <span class="c1">#     return sign*diff1</span>
    <span class="c1"># else:</span>
    <span class="c1">#     return sign*diff2</span>
    <span class="k">return</span> <span class="n">diff1</span></div>





<div class="viewcode-block" id="main">
<a class="viewcode-back" href="../../../SNOM_AFM_analysis.lib.html#SNOM_AFM_analysis.lib.get_directionality.main">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="n">Fit_Decaying_Amplitude</span><span class="p">()</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">SNOM/AFM Analysis</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2025, Hans-Joachim Schill.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.1.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
    </div>

    

    
  </body>
</html>