

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>snom_analysis.chiralcouplers &mdash; SNOM Analysis 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=8d563738"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            SNOM Analysis
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../readme.html">Readme</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../snom_analysis.html">snom_analysis package</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">SNOM Analysis</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">snom_analysis.chiralcouplers</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for snom_analysis.chiralcouplers</h1><div class="highlight"><pre>
<span></span><span class="sd">&#39;&#39;&#39;This module is ment for the analysis of the chiral couplers measurements. The functionality is based on the main module.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.optimize</span><span class="w"> </span><span class="kn">import</span> <span class="n">curve_fit</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mpl_toolkits.axes_grid1</span><span class="w"> </span><span class="kn">import</span> <span class="n">make_axes_locatable</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy</span><span class="w"> </span><span class="kn">import</span> <span class="n">signal</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pathlib</span>
<span class="n">this_files_path</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">tkinter</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">tk</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tkinter</span><span class="w"> </span><span class="kn">import</span> <span class="n">filedialog</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>


<span class="kn">from</span><span class="w"> </span><span class="nn">.lib.snom_colormaps</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.main</span><span class="w"> </span><span class="kn">import</span> <span class="n">SnomMeasurement</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.lib.phase_analysis</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="c1"># from .lib.get_directionality import ChiralCoupler</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.lib.rectangle_selector</span><span class="w"> </span><span class="kn">import</span> <span class="n">select_rectangle</span>

<div class="viewcode-block" id="ChiralCouplers">
<a class="viewcode-back" href="../../snom_analysis.html#snom_analysis.chiralcouplers.ChiralCouplers">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ChiralCouplers</span><span class="p">(</span><span class="n">SnomMeasurement</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This class builds on the Open_Measurement base class for snom analysis.</span>
<span class="sd">    This class was initiated for a more detailed analysis of measurements of the chiral couplers.</span>
<span class="sd">    The basic idea is to find the waveguides by reducing the measurement and then fitting the waveguide positions.</span>
<span class="sd">    Once the positions of the waveguides are known we can get the amplitudes and phaseprofiles along the waveguides. </span>
<span class="sd">    This will be used to calculate the directionality and optionally the phase difference.</span>

<span class="sd">    Availabe methods are:</span>
<span class="sd">        Find_Waveguides: Tries to find and fit the two waveguides, must be executed before any data can be extracted or used.</span>
<span class="sd">        Extract_WG_Data: This function will extract the data of the specified channel for the left and right waveguide.</span>
<span class="sd">            Requires Find_Waveguides to be executed beforehand.</span>
<span class="sd">        Extract_WG_Data_with_Errors: This function will extract the data of the specified channel for the left and right waveguide and the background in between.</span>
<span class="sd">            Requires Find_Waveguides to be executed beforehand.</span>
<span class="sd">        Export_All_Data: Exports the Data on the waveguides, averaged amplitude and averaged phase.</span>
<span class="sd">            Requires Find_Waveguides to be executed beforehand.</span>
<span class="sd">        Export_All_Data_single_phase_line: Exports the Data on the waveguides, averaged amplitude and phase in the center.</span>
<span class="sd">            Requires Find_Waveguides to be executed beforehand.</span>
<span class="sd">        Export_All_Data_single_phase_line_with_Errors: Exports the Data on the waveguides, averaged amplitude and phase in the center plus background in between.</span>
<span class="sd">            Requires Find_Waveguides to be executed beforehand.</span>
<span class="sd">        Fit_Sawtooth:</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory_name</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">channels</span><span class="p">:</span><span class="nb">list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">autoscale</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">orientation</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a ChiralCouplers object. Inherits from Open_Measurement class and can therefore use all functions from that class.</span>
<span class="sd">        Only has additional functionality to analyse chiral couplers measurements or simulations.</span>

<span class="sd">        Args:</span>
<span class="sd">            directory_name (str): measurement folder, will be given to Open_Measurement class</span>
<span class="sd">            channels (list, optional): channels to get the profile data from, will be given to Open_Measurement class. Defaults to None.</span>
<span class="sd">            title (_type_, optional): title to be displayed, will be given to Open_Measurement class. Defaults to None.</span>
<span class="sd">            autoscale (bool, optional): autoscale data? Will be given to Open_Measurement class. Defaults to True.</span>
<span class="sd">            orientation (str, optional): orientation of the waveguides, &#39;vertical&#39; or &#39;horizontal&#39;. Defaults to &#39;vertical&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orientation</span> <span class="o">=</span> <span class="n">orientation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">removed_lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">directory_name</span><span class="p">,</span> <span class="n">channels</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">autoscale</span><span class="p">)</span>
    
<div class="viewcode-block" id="ChiralCouplers.Find_Waveguides">
<a class="viewcode-back" href="../../snom_analysis.html#snom_analysis.chiralcouplers.ChiralCouplers.Find_Waveguides">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Find_Waveguides</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">preview_channel</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">channels</span><span class="p">:</span><span class="nb">list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">integration_width</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;First lets you select an area of a measurement to reduce to. For chiral couplers to get rid of the bend part.</span>
<span class="sd">        Then it will try to fit the two waveguides. The fit results can then be used to export the data on the waveguides.</span>

<span class="sd">        Args:</span>
<span class="sd">            preview_channel (str, optional): Channel to preview the selection area, should have identical geometry and resolution as the other channels. Defaults to None.</span>
<span class="sd">            channels (list, optional): List of channels if you want to initialize the data at this point. If not specified the channels in memory will be used. Defaults to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Initialize_Data</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">integration_width</span> <span class="o">=</span> <span class="n">integration_width</span>
        <span class="c1"># first select the area to retieve the data from, should be a bit away from the coupler to ignore direct laser interactions</span>
        <span class="c1"># but not too far that the signal vanishes</span>
        <span class="c1"># print(self.height_channel)</span>
        <span class="k">if</span> <span class="n">preview_channel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">preview_channel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="p">:</span>
                <span class="n">height_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">preview_channel</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">height_channel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="p">:</span>
                <span class="n">height_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height_channel</span><span class="p">)]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">height_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Load_Data</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">height_channel</span><span class="p">])[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">XRes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">height_data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">YRes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">height_data</span><span class="p">)</span>
        <span class="n">selection</span> <span class="o">=</span> <span class="n">select_rectangle</span><span class="p">(</span><span class="n">height_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height_channel</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Write_to_Logfile</span><span class="p">(</span><span class="s1">&#39;select_rectangle&#39;</span><span class="p">,</span> <span class="n">selection</span><span class="p">)</span>
        <span class="c1"># print(&#39;selection: &#39;, selection)</span>
        <span class="c1"># set all data outside the selection to zero and apply auto cut feature to cut the data to specified area</span>
        <span class="n">mask_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">YRes</span><span class="p">,</span> <span class="n">XRes</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">YRes</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">y</span> <span class="o">&gt;</span> <span class="n">selection</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span><span class="n">y</span> <span class="o">&lt;</span> <span class="n">selection</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">XRes</span><span class="p">):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">selection</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">selection</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
                        <span class="n">mask_array</span><span class="p">[</span><span class="n">y</span><span class="p">][</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                      
        <span class="n">height_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">height_data</span><span class="p">,</span> <span class="n">mask_array</span><span class="p">)</span>
        <span class="n">height_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Auto_Cut_Data</span><span class="p">(</span><span class="n">height_data</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">all_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">channel</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">channel</span><span class="p">)],</span> <span class="n">mask_array</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">all_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">channel</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Auto_Cut_Data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">channel</span><span class="p">)])</span>
            <span class="k">if</span> <span class="n">channel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">amp_channels</span><span class="p">:</span>
                <span class="n">amp_channel</span> <span class="o">=</span> <span class="n">channel</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">channel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase_channels</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">channel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">corrected_phase_channels</span><span class="p">):</span>
                <span class="n">phase_channel</span> <span class="o">=</span> <span class="n">channel</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">height_data</span> <span class="o">=</span> <span class="n">height_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wg_positions</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># data used for displaying with the fit to the waveguides, typically the height profile is shown as this is the basis for the fits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">height_data</span>
        <span class="c1"># finally start the fitting procedure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Fit_Wgs</span><span class="p">()</span></div>

    
    <span class="k">def</span><span class="w"> </span><span class="nf">_Fit_Wgs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wg_height</span><span class="o">=</span><span class="mi">65</span><span class="p">,</span> <span class="n">max_shift</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;This fits the height channel with two gaussians to find the two waveguide positions for each row.</span>
<span class="sd">        The coefficients will be stored in an instance variable list_of_coefficients. The list will also be saved as .txt.</span>
<span class="sd">        The coefficients will be used later to extract the data from the measurements on the waveguides.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># max shift is to limit jumping of the center point</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">orientation</span> <span class="o">==</span> <span class="s1">&#39;vertical&#39;</span><span class="p">:</span>
            <span class="n">width</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height_data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">max_shift</span> <span class="o">=</span> <span class="n">max_shift</span><span class="o">*</span><span class="n">width</span>
            <span class="c1"># p0 = [wg_height, (width)/4, (width)/4*3, 5, 0]</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="p">[</span><span class="n">wg_height</span><span class="p">,</span> <span class="p">(</span><span class="n">width</span><span class="p">)</span><span class="o">/</span><span class="mi">5</span><span class="p">,</span> <span class="p">(</span><span class="n">width</span><span class="p">)</span><span class="o">/</span><span class="mi">5</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">bounds</span> <span class="o">=</span> <span class="p">([</span><span class="n">wg_height</span><span class="o">-</span><span class="mi">15</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1000</span><span class="p">],</span> <span class="p">[</span><span class="n">wg_height</span><span class="o">+</span><span class="mi">15</span><span class="p">,</span> <span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">1000</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">list_of_coefficients</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;starting the fitting procedure&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height_data</span><span class="p">)):</span>
                <span class="c1"># check if row in removed areas</span>
                <span class="k">if</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">removed_lines</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">list_of_coefficients</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p0</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">coeff</span><span class="p">,</span> <span class="n">var_matrix</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">Double_Gauss</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">width</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">height_data</span><span class="p">[</span><span class="n">row</span><span class="p">],</span> <span class="n">p0</span><span class="o">=</span><span class="n">p0</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">)</span>
                    <span class="c1"># coeff = [A, mu_1, mu_2, sigma, offset]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">list_of_coefficients</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coeff</span><span class="p">)</span>
                    <span class="n">p0</span> <span class="o">=</span> <span class="n">coeff</span> <span class="c1">#set the starting parameters for the next fit</span>
                    <span class="c1"># bounds = ([wg_height-15, 0, width/2, 0, -1000], [wg_height+15, width/2, width, width/2, 1000])</span>
                    <span class="c1"># bounds = ([wg_height-15, p0[1]-max_shift, p0[2]-max_shift, 0, -1000], [wg_height+15, p0[1]+max_shift, p0[2]+max_shift, width/2, 1000])</span>
                    <span class="c1"># print(coeff)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">removed_lines</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># interpolate missing lines by linear function between first fit before and afterwards</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_Fill_Removed_Lines</span><span class="p">()</span>


            <span class="n">mean_sigma</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">list_of_coefficients</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_of_coefficients</span><span class="p">))]</span>
            <span class="n">mean_sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">mean_sigma</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">integration_width</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">integ_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">mean_sigma</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_Get_Fit_Feedback</span><span class="p">()</span> <span class="c1">#asks if the fit went nicely, otherwise the user can repeat the fit</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_Get_Integration_Width</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">integ_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">integration_width</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_Get_Fit_Feedback</span><span class="p">()</span> <span class="c1">#asks if the fit went nicely, otherwise the user can repeat the fit</span>
        <span class="c1"># save list of coefficients</span>
        <span class="c1"># filepath = os.path.normpath(os.path.join(this_files_path, &#39;../chiralcouplers_analysis/extracted_data/fit_coefficients&#39;))# old and too specific</span>
        <span class="c1"># filepath = os.path.normpath(os.path.join(self.directory_name, &#39;../extracted_data/fit_coefficients&#39;))</span>
        <span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory_name</span><span class="p">,</span> <span class="s1">&#39;../extracted_data_with_overlay/fit_coefficients&#39;</span><span class="p">))</span>
        <span class="n">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="n">current_datetime</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">/%m/%Y %H:%M:%S&quot;</span><span class="p">)</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">current_datetime</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;filename = &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">directory_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#</span><span class="se">\t</span><span class="s1">A</span><span class="se">\t</span><span class="s1">mu_1</span><span class="se">\t</span><span class="s1">mu_2</span><span class="se">\t</span><span class="s1">sigma</span><span class="se">\t</span><span class="s1">offset</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_of_coefficients</span><span class="p">)):</span>
            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_of_coefficients</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_of_coefficients</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_of_coefficients</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_of_coefficients</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_of_coefficients</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">4</span><span class="p">],</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_Fill_Removed_Lines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">jumps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Find_Jumps_in_Array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">removed_lines</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">jumps</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">jumps</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">removed_lines</span><span class="p">)]</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;jumps: &#39;</span><span class="p">,</span> <span class="n">jumps</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">jump</span> <span class="ow">in</span> <span class="n">jumps</span><span class="p">:</span>
            <span class="c1"># get previous positions:</span>
            <span class="n">left_prev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_of_coefficients</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">removed_lines</span><span class="p">[</span><span class="n">start</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">right_prev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_of_coefficients</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">removed_lines</span><span class="p">[</span><span class="n">start</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;left_prev=&#39;</span><span class="p">,</span> <span class="n">left_prev</span><span class="p">)</span>
            <span class="c1"># get position after jump:</span>
            <span class="n">left_after</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_of_coefficients</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">removed_lines</span><span class="p">[</span><span class="n">jump</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">right_after</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_of_coefficients</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">removed_lines</span><span class="p">[</span><span class="n">jump</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;left_after=&#39;</span><span class="p">,</span> <span class="n">left_after</span><span class="p">)</span>
            <span class="c1">#determine interpolation function:</span>
            <span class="c1"># f(x)=mx+n</span>
            <span class="n">m_left</span> <span class="o">=</span> <span class="p">(</span><span class="n">left_after</span><span class="o">-</span><span class="n">left_prev</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">jump</span><span class="o">-</span><span class="mi">1</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span>
            <span class="n">m_right</span> <span class="o">=</span> <span class="p">(</span><span class="n">right_after</span><span class="o">-</span><span class="n">right_prev</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">jump</span><span class="o">-</span><span class="mi">1</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span>
            <span class="n">m_mean</span> <span class="o">=</span> <span class="p">(</span><span class="n">m_left</span><span class="o">+</span><span class="n">m_right</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;m_mean: &#39;</span><span class="p">,</span> <span class="n">m_mean</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;start: &#39;</span><span class="p">,</span> <span class="n">start</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;jump: &#39;</span><span class="p">,</span> <span class="n">jump</span><span class="p">)</span>

            <span class="k">def</span><span class="w"> </span><span class="nf">function_left</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">m_mean</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">left_prev</span> <span class="o">-</span> <span class="n">m_mean</span><span class="o">*</span><span class="n">start</span>
            
            <span class="k">def</span><span class="w"> </span><span class="nf">function_right</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">m_mean</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">right_prev</span> <span class="o">-</span> <span class="n">m_mean</span><span class="o">*</span><span class="n">start</span>

            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">jump</span><span class="p">):</span>
                <span class="n">left_mu</span> <span class="o">=</span> <span class="n">function_left</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="n">right_mu</span> <span class="o">=</span> <span class="n">function_right</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">list_of_coefficients</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">removed_lines</span><span class="p">[</span><span class="n">line</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">left_mu</span><span class="p">,</span> <span class="n">right_mu</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Filled line: &#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_of_coefficients</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">removed_lines</span><span class="p">[</span><span class="n">line</span><span class="p">]])</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">jump</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_Find_Jumps_in_Array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;finds jumps in ordered list of integers&#39;&#39;&#39;</span>
        <span class="n">jumps</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">last_element</span> <span class="o">=</span> <span class="n">array</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">last_element</span> <span class="o">&lt;</span> <span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">jumps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">last_element</span> <span class="o">=</span> <span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">jumps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># append also the last index</span>
        <span class="k">return</span> <span class="n">jumps</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_Select_Lines_to_Remove</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># self.removed_areas = []</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">removed_lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">user_input</span> <span class="o">=</span> <span class="s1">&#39;y&#39;</span>
        <span class="k">while</span> <span class="n">user_input</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
            <span class="n">selection</span> <span class="o">=</span> <span class="n">select_rectangle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height_channel</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">selection</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">selection</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">removed_lines</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">removed_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">user_input</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Do you want to select an other area to remove? enter y/n: &#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The removed areas are: &#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">removed_lines</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_Get_Fit_Feedback</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Plot_Data_With_Fit_And_Bounds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height_data</span><span class="p">,</span> <span class="s1">&#39;Z&#39;</span><span class="p">)</span>
        <span class="n">user_input</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Are you happy with the current fit? y/n: &#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">user_input</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">user_input</span> <span class="o">==</span> <span class="s1">&#39;n&#39;</span><span class="p">:</span>
            <span class="n">user_input</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Do you want to retry the fit from the beginning? enter 0:</span><span class="se">\n</span><span class="s1">Do you want to remove areas from the fit? enter 1: &#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">user_input</span> <span class="o">==</span> <span class="s1">&#39;0&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Find_Waveguides</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="p">)</span>
                <span class="c1">#operations like scaling and blurring will be lost...</span>
            <span class="k">elif</span> <span class="n">user_input</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_Select_Lines_to_Remove</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_Fit_Wgs</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Please enter n or y!&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_Get_Fit_Feedback</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Please enter n or y!&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_Get_Fit_Feedback</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_Get_Integration_Width</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Plot_Data_With_Fit_And_Bounds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height_data</span><span class="p">,</span> <span class="s1">&#39;Z&#39;</span><span class="p">)</span>
        <span class="n">user_input</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Do you like the extraction width? Current width is </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">integ_width</span><span class="si">}</span><span class="s1"> y/n: &#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">user_input</span> <span class="o">==</span> <span class="s1">&#39;n&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">integ_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Please enter the new extraction width as an integer: &#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_Get_Integration_Width</span><span class="p">()</span> <span class="c1"># call recursively until user is happy with integ_width</span>
        <span class="k">elif</span> <span class="n">user_input</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_Write_to_Logfile</span><span class="p">(</span><span class="s1">&#39;integ_width&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">integ_width</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Please enter n or y!&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_Get_Integration_Width</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_Plot_Data_With_Fit_And_Bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">channel</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This method will display the data and additionally show the center of the gaussian fits plus the chosen export width.</span>

<span class="sd">        Args:</span>
<span class="sd">            data (np.array): the data to display</span>
<span class="sd">            channel (str): specifies the colormap</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>    
        <span class="c1"># fig.set_figheight(self.figsizey)</span>
        <span class="c1"># fig.set_figwidth(self.figsizex) </span>
        
        <span class="n">yres</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;Z&#39;</span> <span class="ow">in</span> <span class="n">channel</span><span class="p">:</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;gray&#39;</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;height [nm]&#39;</span>
            <span class="n">axis</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">list_of_coefficients</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">yres</span><span class="p">)],</span> <span class="nb">range</span><span class="p">(</span><span class="n">yres</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
            <span class="n">axis</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">list_of_coefficients</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">yres</span><span class="p">)],</span> <span class="nb">range</span><span class="p">(</span><span class="n">yres</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s1">&#39;A&#39;</span> <span class="ow">in</span> <span class="n">channel</span><span class="p">:</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="n">SNOM_amplitude</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;amplitude [a.u.]&#39;</span>
        <span class="k">elif</span> <span class="s1">&#39;P&#39;</span> <span class="ow">in</span> <span class="n">channel</span><span class="p">:</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="n">SNOM_phase</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;phase&#39;</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
        <span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
        <span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;5%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
        <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">)</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_yaxis</span><span class="p">()</span><span class="o">.</span><span class="n">labelpad</span> <span class="o">=</span> <span class="mi">15</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">270</span><span class="p">)</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;finding the wgs&#39;</span><span class="p">)</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;scaled&#39;</span><span class="p">)</span>
        <span class="c1"># left wg extraction bounds</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">list_of_coefficients</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">integ_width</span><span class="o">-</span><span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">yres</span><span class="p">)],</span> <span class="nb">range</span><span class="p">(</span><span class="n">yres</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">list_of_coefficients</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">integ_width</span><span class="o">+</span><span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">yres</span><span class="p">)],</span> <span class="nb">range</span><span class="p">(</span><span class="n">yres</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
        <span class="c1"># right wg extraction bounds</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">list_of_coefficients</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">integ_width</span><span class="o">-</span><span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">yres</span><span class="p">)],</span> <span class="nb">range</span><span class="p">(</span><span class="n">yres</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">list_of_coefficients</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">integ_width</span><span class="o">+</span><span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">yres</span><span class="p">)],</span> <span class="nb">range</span><span class="p">(</span><span class="n">yres</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<div class="viewcode-block" id="ChiralCouplers.Extract_WG_Data">
<a class="viewcode-back" href="../../snom_analysis.html#snom_analysis.chiralcouplers.ChiralCouplers.Extract_WG_Data">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Extract_WG_Data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This function will extract the data of the specified channel for the left and right waveguide. </span>
<span class="sd">        An instance variable containing both data sets is created (left_wg_data, right_wg_data).</span>

<span class="sd">        Args:</span>
<span class="sd">            channel (str): channel to extract the data from</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">wg_positions</span> <span class="o">=</span> <span class="p">[[</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_of_coefficients</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_of_coefficients</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height_data</span><span class="p">))]</span>
        <span class="c1"># print(&#39;wg_positions&#39;, wg_positions)</span>
        <span class="c1"># print(&#39;integ_width: &#39;, integ_width)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">left_wg_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">right_wg_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wg_positions</span><span class="p">)):</span>
            <span class="n">wg_left</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">wg_positions</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">wg_right</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">wg_positions</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">left_wg_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_array</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">channel</span><span class="p">)][</span><span class="n">row</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">wg_left</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">integ_width</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="n">wg_left</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">integ_width</span><span class="p">)])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">right_wg_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_array</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">channel</span><span class="p">)][</span><span class="n">row</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">wg_right</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">integ_width</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="n">wg_right</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">integ_width</span><span class="p">)])</span></div>

    
<div class="viewcode-block" id="ChiralCouplers.Extract_WG_Data_with_Errors">
<a class="viewcode-back" href="../../snom_analysis.html#snom_analysis.chiralcouplers.ChiralCouplers.Extract_WG_Data_with_Errors">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Extract_WG_Data_with_Errors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This function will extract the data of the specified channel for the left and right waveguide. </span>
<span class="sd">        An instance variable containing both data sets is created (left_wg_data, right_wg_data).</span>
<span class="sd">        Additionally also the area in between the two waveguides is extracted as background_data.</span>
<span class="sd">        The background data will be used for an error estimation.</span>

<span class="sd">        Args:</span>
<span class="sd">            channel (str): channel to extract the data from</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">wg_positions</span> <span class="o">=</span> <span class="p">[[</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_of_coefficients</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_of_coefficients</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height_data</span><span class="p">))]</span>
        <span class="c1"># print(&#39;wg_positions&#39;, wg_positions)</span>
        <span class="c1"># print(&#39;integ_width: &#39;, integ_width)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">left_wg_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">right_wg_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">background_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wg_positions</span><span class="p">)):</span>
            <span class="n">wg_left</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">wg_positions</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">wg_right</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">wg_positions</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">left_wg_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_array</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">channel</span><span class="p">)][</span><span class="n">row</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">wg_left</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">integ_width</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="n">wg_left</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">integ_width</span><span class="p">)])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">right_wg_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_array</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">channel</span><span class="p">)][</span><span class="n">row</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">wg_right</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">integ_width</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="n">wg_right</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">integ_width</span><span class="p">)])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">background_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_array</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">channel</span><span class="p">)][</span><span class="n">row</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">wg_left</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">integ_width</span><span class="o">*</span><span class="mi">2</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="n">wg_right</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">integ_width</span><span class="o">*</span><span class="mi">2</span><span class="p">)])</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_Data_Mean</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mean_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># print(&#39;in _Data_Mean, print channels: &#39;, self.channels)</span>
        <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;Z&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">channel</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Extract_WG_Data</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>
                <span class="n">left_mean_array</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">right_mean_array</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="s1">&#39;P&#39;</span> <span class="ow">in</span> <span class="n">channel</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">left_center_phase</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">right_center_phase</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_array</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">channel</span><span class="p">)])):</span>
                    <span class="c1"># create additional list only containing center phase data points</span>
                    <span class="k">if</span> <span class="s1">&#39;P&#39;</span> <span class="ow">in</span> <span class="n">channel</span><span class="p">:</span>
                        <span class="n">left_phase</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">left_wg_data</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">integ_width</span><span class="o">/</span><span class="mi">2</span><span class="p">)]</span>
                        <span class="n">right_phase</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">right_wg_data</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">integ_width</span><span class="o">/</span><span class="mi">2</span><span class="p">)]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">left_center_phase</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">left_phase</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">right_center_phase</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">right_phase</span><span class="p">)</span>
                    <span class="n">sum_left</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">sum_right</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">amp_left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_wg_data</span><span class="p">[</span><span class="n">row</span><span class="p">]</span>
                    <span class="n">amp_right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_wg_data</span><span class="p">[</span><span class="n">row</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">integ_width</span><span class="p">):</span>
                        <span class="n">sum_left</span><span class="o">+=</span><span class="n">amp_left</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                        <span class="n">sum_right</span><span class="o">+=</span><span class="n">amp_right</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                    <span class="n">left_mean_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sum_left</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">integ_width</span><span class="p">))</span>
                    <span class="n">right_mean_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sum_right</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">integ_width</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mean_data</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">channel</span><span class="p">,</span> <span class="n">left_mean_array</span><span class="p">,</span> <span class="n">right_mean_array</span><span class="p">])</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_Data_Mean_with_Errors</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This function will create the mean values from the extracted amplitude data. The mean data is stored in a new instance variable mean_data.</span>
<span class="sd">        The phase data is just used to get the phase profile in the center of the waveguide, this leads to more reliable results, as averaging phase typically does not work out well.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mean_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># print(&#39;in _Data_Mean, print channels: &#39;, self.channels)</span>
        <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;Z&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">channel</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Extract_WG_Data_with_Errors</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>
                <span class="n">left_mean_array</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">right_mean_array</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">background_mean_array</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="s1">&#39;P&#39;</span> <span class="ow">in</span> <span class="n">channel</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">left_center_phase</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">right_center_phase</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_array</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">channel</span><span class="p">)])):</span>
                    <span class="c1"># create additional list only containing center phase data points</span>
                    <span class="k">if</span> <span class="s1">&#39;P&#39;</span> <span class="ow">in</span> <span class="n">channel</span><span class="p">:</span>
                        <span class="n">left_phase</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">left_wg_data</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">integ_width</span><span class="o">/</span><span class="mi">2</span><span class="p">)]</span>
                        <span class="n">right_phase</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">right_wg_data</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">integ_width</span><span class="o">/</span><span class="mi">2</span><span class="p">)]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">left_center_phase</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">left_phase</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">right_center_phase</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">right_phase</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="s1">&#39;A&#39;</span> <span class="ow">in</span> <span class="n">channel</span> <span class="ow">or</span> <span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">channel</span> <span class="ow">or</span> <span class="s1">&#39;I&#39;</span> <span class="ow">in</span> <span class="n">channel</span><span class="p">:</span> <span class="c1"># amplitude, realpart and imaginary part</span>
                        <span class="n">sum_left</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="n">sum_right</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="n">sum_background</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="n">amp_left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_wg_data</span><span class="p">[</span><span class="n">row</span><span class="p">]</span>
                        <span class="n">amp_right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_wg_data</span><span class="p">[</span><span class="n">row</span><span class="p">]</span>
                        <span class="n">amp_background</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">background_data</span><span class="p">[</span><span class="n">row</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">integ_width</span><span class="p">):</span>
                            <span class="n">sum_left</span><span class="o">+=</span><span class="n">amp_left</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                            <span class="n">sum_right</span><span class="o">+=</span><span class="n">amp_right</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">amp_background</span><span class="p">)):</span>
                            <span class="n">sum_background</span><span class="o">+=</span><span class="n">amp_background</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                    <span class="c1"># change background if channel is realpart:</span>
                    <span class="k">if</span> <span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">channel</span> <span class="ow">or</span> <span class="s1">&#39;I&#39;</span> <span class="ow">in</span> <span class="n">channel</span><span class="p">:</span>
                        <span class="c1"># for now get the mean of the absolute values</span>
                        <span class="n">abs_values</span> <span class="o">=</span> <span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">element</span><span class="p">)</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">amp_background</span><span class="p">]</span>
                        <span class="n">sum_background</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">abs_values</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The channel cannot be identified properly. In _Data_Mean_with_Errors&#39;</span><span class="p">)</span>
                    <span class="n">left_mean_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sum_left</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">integ_width</span><span class="p">))</span>
                    <span class="n">right_mean_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sum_right</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">integ_width</span><span class="p">))</span>
                    <span class="n">background_mean_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sum_background</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">amp_background</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mean_data</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">channel</span><span class="p">,</span> <span class="n">left_mean_array</span><span class="p">,</span> <span class="n">right_mean_array</span><span class="p">,</span> <span class="n">background_mean_array</span><span class="p">])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_Get_Data_Pairs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="n">all_indices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">allowed_channel_types</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">]</span>
        <span class="n">data_pairs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># print(&#39;Trying to find pairs&#39;)</span>
        <span class="c1"># for i in range(len(self.mean_data)):</span>
            <span class="c1"># print(self.mean_data[i][0])</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mean_data</span><span class="p">)):</span>
            <span class="n">channel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="c1"># print(&#39;channel1: &#39;, channel)</span>
            <span class="n">channel</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">channel_type</span> <span class="o">=</span> <span class="n">channel</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="c1"># print(&#39;channel type1: &#39;, channel_type)</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">channel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># basically the demodulation order of the channel, so 1 for O1A</span>
            <span class="c1"># print(&#39;index1: &#39;, index)</span>
            <span class="c1"># channels must be sorted! amp comes first then phase</span>
            <span class="k">if</span> <span class="n">index</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">all_indices</span> <span class="ow">and</span> <span class="n">channel_type</span> <span class="ow">in</span> <span class="n">allowed_channel_types</span> <span class="ow">and</span> <span class="n">channel_type</span><span class="o">==</span><span class="n">allowed_channel_types</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mean_data</span><span class="p">)):</span>
                    <span class="n">channel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="c1"># print(&#39;channel2: &#39;, channel)</span>
                    <span class="n">channel</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="n">new_channel_type</span> <span class="o">=</span> <span class="n">channel</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                    <span class="c1"># print(&#39;channel type2: &#39;, new_channel_type)</span>
                    <span class="n">new_index</span> <span class="o">=</span> <span class="n">channel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="c1"># print(&#39;index2: &#39;, new_index)</span>

                    <span class="k">if</span> <span class="n">new_index</span> <span class="o">==</span> <span class="n">index</span> <span class="ow">and</span> <span class="n">new_channel_type</span> <span class="ow">in</span> <span class="n">allowed_channel_types</span> <span class="ow">and</span> <span class="n">new_channel_type</span><span class="o">!=</span><span class="n">channel_type</span><span class="p">:</span>
                        <span class="c1"># print(&#39;found a pair!&#39;)</span>
                        <span class="n">all_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mean_data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span> <span class="c1"># channel, left_mean_array, right_mean_array, background_mean_array</span>
                            <span class="n">data_pairs</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">index</span> <span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mean_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">]],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mean_data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">]]])</span> <span class="c1"># [index, [amp_leftwg, amp_rightwg, amp_background], [phase_leftwg, phase_rightwg]]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">data_pairs</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">index</span> <span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mean_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mean_data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">]]])</span> <span class="c1"># [index, [amp_leftwg, amp_rightwg], [phase_leftwg, phase_rightwg]]</span>
        <span class="k">return</span> <span class="n">data_pairs</span>

<div class="viewcode-block" id="ChiralCouplers.Export_All_Data">
<a class="viewcode-back" href="../../snom_analysis.html#snom_analysis.chiralcouplers.ChiralCouplers.Export_All_Data">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Export_All_Data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Data_Mean</span><span class="p">()</span> <span class="c1"># create mean data</span>
        <span class="n">data_pairs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Get_Data_Pairs</span><span class="p">()</span> <span class="c1"># get data pairs from the mean data list </span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_pairs</span><span class="p">)):</span>
            <span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">this_files_path</span><span class="p">,</span> <span class="s1">&#39;../chiralcouplers_analysis/extracted_data&#39;</span><span class="p">))</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s1">_all_data_O</span><span class="si">{</span><span class="n">data_pairs</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">.txt&#39;</span>
            <span class="n">filepath</span> <span class="o">=</span> <span class="n">filepath</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">filename</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">datafile</span><span class="p">:</span>
                <span class="n">datafile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#pixel</span><span class="se">\t</span><span class="s1">amp leftwg</span><span class="se">\t</span><span class="s1">amp rightwg</span><span class="se">\t</span><span class="s1">phase leftwg</span><span class="se">\t</span><span class="s1">phase rightwg</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_pairs</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])):</span>
                    <span class="n">datafile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">data_pairs</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">data_pairs</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">data_pairs</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">data_pairs</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Exported all data to </span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="s1">!&#39;</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="ChiralCouplers.Export_All_Data_single_phase_line">
<a class="viewcode-back" href="../../snom_analysis.html#snom_analysis.chiralcouplers.ChiralCouplers.Export_All_Data_single_phase_line">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Export_All_Data_single_phase_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Data_Mean</span><span class="p">()</span> <span class="c1"># create mean data</span>
        <span class="n">data_pairs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Get_Data_Pairs</span><span class="p">()</span> <span class="c1"># get data pairs from the mean data list </span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_pairs</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">filepath</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">this_files_path</span><span class="p">,</span> <span class="s1">&#39;../chiralcouplers_analysis/extracted_data&#39;</span><span class="p">))</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s1">_all_data_O</span><span class="si">{</span><span class="n">data_pairs</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">_center_phase.txt&#39;</span>
            <span class="n">complete_filename</span> <span class="o">=</span> <span class="n">filepath</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">filename</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">complete_filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">datafile</span><span class="p">:</span>
                <span class="n">datafile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#pixel</span><span class="se">\t</span><span class="s1">amp leftwg</span><span class="se">\t</span><span class="s1">amp rightwg</span><span class="se">\t</span><span class="s1">phase leftwg</span><span class="se">\t</span><span class="s1">phase rightwg</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_pairs</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])):</span>
                    <span class="n">datafile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">data_pairs</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">data_pairs</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">left_center_phase</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">right_center_phase</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Exported all data to </span><span class="si">{</span><span class="n">complete_filename</span><span class="si">}</span><span class="s1">!&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="ChiralCouplers.Export_All_Data_single_phase_line_with_Errors">
<a class="viewcode-back" href="../../snom_analysis.html#snom_analysis.chiralcouplers.ChiralCouplers.Export_All_Data_single_phase_line_with_Errors">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Export_All_Data_single_phase_line_with_Errors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This method first extracts the waveguide data by selecting an area in the scan and then fitting the waveguide positions.</span>
<span class="sd">        Subsequently the extracted amplitude data is averaged, for the phase only the values in the middle of the waveguides are used.</span>
<span class="sd">        The averaged profiles and phase data are stored in data_pairs for each demodulation order. This is based on the channels specified earlier and requires that</span>
<span class="sd">        Find_Waveguides was executed prior to this method.</span>

<span class="sd">        Args:</span>
<span class="sd">            filepath (str, optional): where to save the extracted data? The filename is created automatically. Defaults to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Data_Mean_with_Errors</span><span class="p">()</span> <span class="c1"># create mean data</span>
        <span class="n">data_pairs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Get_Data_Pairs</span><span class="p">()</span> <span class="c1"># get data pairs from the mean data list </span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_pairs</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">filepath</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">this_files_path</span><span class="p">,</span> <span class="s1">&#39;../chiralcouplers_analysis/extracted_data&#39;</span><span class="p">))</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s1">_all_data_O</span><span class="si">{</span><span class="n">data_pairs</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">_center_phase_with_errors.txt&#39;</span>
            <span class="n">complete_filename</span> <span class="o">=</span> <span class="n">filepath</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">filename</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">complete_filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">datafile</span><span class="p">:</span>
                <span class="n">datafile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#pixel</span><span class="se">\t</span><span class="s1">amp leftwg</span><span class="se">\t</span><span class="s1">amp rightwg</span><span class="se">\t</span><span class="s1">phase leftwg</span><span class="se">\t</span><span class="s1">phase rightwg</span><span class="se">\t</span><span class="s1">amp background</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_pairs</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])):</span>
                    <span class="n">datafile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">data_pairs</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">data_pairs</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">left_center_phase</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">right_center_phase</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">data_pairs</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Exported all data to </span><span class="si">{</span><span class="n">complete_filename</span><span class="si">}</span><span class="s1">!&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="ChiralCouplers.Export_Realpart_with_Errors">
<a class="viewcode-back" href="../../snom_analysis.html#snom_analysis.chiralcouplers.ChiralCouplers.Export_Realpart_with_Errors">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Export_Realpart_with_Errors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Data_Mean_with_Errors</span><span class="p">()</span> <span class="c1"># create mean data</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mean_data</span><span class="p">)):</span>
            <span class="n">channel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">channel</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">filepath</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">this_files_path</span><span class="p">,</span> <span class="s1">&#39;../chiralcouplers_analysis/extracted_data&#39;</span><span class="p">))</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s1">_all_data_</span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s1">_realpart_with_errors.txt&#39;</span>
                <span class="n">complete_filename</span> <span class="o">=</span> <span class="n">filepath</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">filename</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">complete_filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">datafile</span><span class="p">:</span>
                    <span class="n">datafile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#pixel</span><span class="se">\t</span><span class="s1">real leftwg</span><span class="se">\t</span><span class="s1">real rightwg</span><span class="se">\t</span><span class="s1">real background</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mean_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])):</span>
                        <span class="n">datafile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mean_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">],</span><span class="mi">5</span><span class="p">)</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mean_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">j</span><span class="p">],</span><span class="mi">5</span><span class="p">)</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mean_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">][</span><span class="n">j</span><span class="p">],</span><span class="mi">5</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Exported all data to </span><span class="si">{</span><span class="n">complete_filename</span><span class="si">}</span><span class="s1">!&#39;</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="ChiralCouplers.Export_Complex_Data_with_Errors">
<a class="viewcode-back" href="../../snom_analysis.html#snom_analysis.chiralcouplers.ChiralCouplers.Export_Complex_Data_with_Errors">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Export_Complex_Data_with_Errors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Exports realpart and imaginary part if those channels are in memory.</span>

<span class="sd">        Args:</span>
<span class="sd">            filepath (str, optional): _description_. Defaults to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Data_Mean_with_Errors</span><span class="p">()</span> <span class="c1"># create mean data</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mean_data</span><span class="p">)):</span>
            <span class="n">channel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">channel</span><span class="p">:</span>
                <span class="n">demodulation</span> <span class="o">=</span> <span class="n">channel</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">real_channel</span> <span class="o">=</span> <span class="n">channel</span>
                <span class="n">imag_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">imag_channel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mean_data</span><span class="p">)):</span>
                        <span class="k">if</span> <span class="n">imag_channel</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_data</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
                            <span class="n">k</span> <span class="o">=</span> <span class="n">l</span> <span class="c1"># get the channel index of the imag channel, to later refer to the data</span>
                            <span class="nb">print</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                            <span class="k">break</span>
                    <span class="k">if</span> <span class="n">filepath</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">this_files_path</span><span class="p">,</span> <span class="s1">&#39;../chiralcouplers_analysis/extracted_data&#39;</span><span class="p">))</span>
                    <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s1">_all_data_</span><span class="si">{</span><span class="n">demodulation</span><span class="si">}</span><span class="s1">_complex_with_errors.txt&#39;</span>
                    <span class="n">complete_filename</span> <span class="o">=</span> <span class="n">filepath</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">filename</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">complete_filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">datafile</span><span class="p">:</span>
                        <span class="n">datafile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#pixel</span><span class="se">\t</span><span class="s1">real leftwg</span><span class="se">\t</span><span class="s1">real rightwg</span><span class="se">\t</span><span class="s1">real background</span><span class="se">\t</span><span class="s1">imag leftwg</span><span class="se">\t</span><span class="s1">imag rightwg</span><span class="se">\t</span><span class="s1">imag background</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mean_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])):</span>
                            <span class="n">datafile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mean_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">],</span><span class="mi">5</span><span class="p">)</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mean_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">j</span><span class="p">],</span><span class="mi">5</span><span class="p">)</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mean_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">][</span><span class="n">j</span><span class="p">],</span><span class="mi">5</span><span class="p">)</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mean_data</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">],</span><span class="mi">5</span><span class="p">)</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mean_data</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">j</span><span class="p">],</span><span class="mi">5</span><span class="p">)</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mean_data</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">3</span><span class="p">][</span><span class="n">j</span><span class="p">],</span><span class="mi">5</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Exported all data to </span><span class="si">{</span><span class="n">complete_filename</span><span class="si">}</span><span class="s1">!&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="ChiralCouplers.Export_Amplitude_with_Errors">
<a class="viewcode-back" href="../../snom_analysis.html#snom_analysis.chiralcouplers.ChiralCouplers.Export_Amplitude_with_Errors">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Export_Amplitude_with_Errors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This method first extracts the waveguide data by selecting an area in the scan and then fitting the waveguide positions.</span>
<span class="sd">        Subsequently the extracted amplitude data is averaged.</span>
<span class="sd">        The averaged profiles are stored in data_pairs for each demodulation order. This is based on the channels specified earlier and requires that</span>
<span class="sd">        Find_Waveguides was executed prior to this method.</span>

<span class="sd">        Args:</span>
<span class="sd">            filepath (str, optional): where to save the extracted data? The filename is created automatically. Defaults to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Data_Mean_with_Errors</span><span class="p">()</span> <span class="c1"># create mean data</span>
        <span class="n">data_pairs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Get_Data_Pairs</span><span class="p">()</span> <span class="c1"># get data pairs from the mean data list </span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_pairs</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">filepath</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">this_files_path</span><span class="p">,</span> <span class="s1">&#39;../chiralcouplers_analysis/extracted_data&#39;</span><span class="p">))</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s1">_all_data_O</span><span class="si">{</span><span class="n">data_pairs</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">_center_phase_with_errors.txt&#39;</span>
            <span class="n">complete_filename</span> <span class="o">=</span> <span class="n">filepath</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">filename</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">complete_filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">datafile</span><span class="p">:</span>
                <span class="n">datafile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#pixel</span><span class="se">\t</span><span class="s1">amp leftwg</span><span class="se">\t</span><span class="s1">amp rightwg</span><span class="se">\t</span><span class="s1">amp background</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_pairs</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])):</span>
                    <span class="n">datafile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">data_pairs</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">data_pairs</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">data_pairs</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Exported amp data to </span><span class="si">{</span><span class="n">complete_filename</span><span class="si">}</span><span class="s1">!&#39;</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="LoadData">
<a class="viewcode-back" href="../../snom_analysis.html#snom_analysis.chiralcouplers.LoadData">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">LoadData</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This class is ment to load the profiles created with the ChiralCouplers class and comsol profiles.</span>
<span class="sd">    From the profiles the directionality can be calculated and compared.</span>

<span class="sd">    Available functions are:</span>
<span class="sd">        Load_Extracted_Data: Loads the extracted profiles for amp and phase in left and right wg and if with_errors==True also background.</span>
<span class="sd">        Cut_Data: Remove part of the profiles from end or beginning, only used for comsol data to remove oscillations in the beginning.</span>
<span class="sd">        Fit_Amplitudes: This fits the amplitude profiles and creates the propagation lenght and directionality. Subsequent load and fit calls will increment the lists.</span>
<span class="sd">        Plot_Propagation_Lengths: Displays the calculated propagation lengths.</span>
<span class="sd">        Plot_Directionality: Displays the directionalities.</span>
<span class="sd">        Export_Directionalities: Exports the directonalities to .txt file.</span>
<span class="sd">        Plot_Phase_Gradient: Displays the phase profiles in left and right wg in several ways like raw phase, corrected, phase difference and variation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initialdir</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">autoload</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">chirality</span><span class="p">:</span><span class="nb">int</span><span class="o">=+</span><span class="mi">1</span><span class="p">,</span> <span class="n">pixelsize</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">with_errors</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This class is ment to load the profiles created with the ChiralCouplers class and comsol profiles.</span>
<span class="sd">        From the profiles the directionality can be calculated and compared.</span>

<span class="sd">        Args:</span>
<span class="sd">            initialdir (str, optional): initial directory, will be used for the file dialogues.</span>
<span class="sd">            title (str, optional): title, will be used for future plots.</span>
<span class="sd">            autoload (bool, optional): if set to True you will automatically be asked to select data files without having to call Load_Extracted_Data manually.</span>
<span class="sd">            chirality (int, optional): chirality of the measurement/simulation. Important for directionality calculation.</span>
<span class="sd">            pixelsize (float, optional): size of pixels in nm, important for plot labels, defaults to 50nm/scaling</span>
<span class="sd">            with_errors (bool, optional): do you want to include an error estimation based on the background in between the two waveguides? Only for snom measurements.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialdir</span> <span class="o">=</span> <span class="n">initialdir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chirality</span> <span class="o">=</span> <span class="n">chirality</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_propagation_lengths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_directionalitys</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_measured_directionalities</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_mode_indices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">pixelsize</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="c1"># for the measurements</span>
            <span class="n">scaling</span> <span class="o">=</span> <span class="mi">4</span>
            <span class="n">pixelsize</span> <span class="o">=</span> <span class="mi">50</span><span class="o">/</span><span class="n">scaling</span> <span class="c1"># in nm </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pixelsize</span> <span class="o">=</span> <span class="n">pixelsize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">with_errors</span> <span class="o">=</span> <span class="n">with_errors</span>
        <span class="k">if</span> <span class="n">autoload</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Load_Extracted_Data</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>

<div class="viewcode-block" id="LoadData.Load_Extracted_Data">
<a class="viewcode-back" href="../../snom_analysis.html#snom_analysis.chiralcouplers.LoadData.Load_Extracted_Data">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Load_Extracted_Data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">initialdir</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">no_phase</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Select the file to load the data from. File format: amp left, amp right, phase left, phase right and if with_errors==True also background, tab delimited, 2 lines header. </span>

<span class="sd">        Args:</span>
<span class="sd">            filepath (str, optional): if not specified you will be prompted with a filedialoge. Defaults to None.</span>
<span class="sd">            initialdir (str, optional): sets the starting directory for the filedialoge. Defaults to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">initialdir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initialdir</span> <span class="o">=</span> <span class="n">initialdir</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Tk</span><span class="p">()</span>
        <span class="n">root</span><span class="o">.</span><span class="n">withdraw</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">filepath</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">initialdir</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">filepath</span> <span class="o">=</span> <span class="n">filedialog</span><span class="o">.</span><span class="n">askopenfilename</span><span class="p">(</span><span class="n">initialdir</span><span class="o">=</span><span class="n">this_files_path</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">filepath</span> <span class="o">=</span> <span class="n">filedialog</span><span class="o">.</span><span class="n">askopenfilename</span><span class="p">(</span><span class="n">initialdir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">this_files_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">initialdir</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filepath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">datafile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">amplitude_left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">datafile</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">skip_header</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">datafile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">datafile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">amplitude_right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">datafile</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">skip_header</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">datafile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">no_phase</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">datafile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phase_left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">datafile</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">skip_header</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">datafile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">datafile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phase_right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">datafile</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">skip_header</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
            <span class="n">datafile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">with_errors</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">datafile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">amp_background</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">datafile</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">skip_header</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
                <span class="n">datafile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">with_errors</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">datafile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">amp_background</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">datafile</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">skip_header</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
                <span class="n">datafile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<div class="viewcode-block" id="LoadData.Load_Extracted_Complex_Data">
<a class="viewcode-back" href="../../snom_analysis.html#snom_analysis.chiralcouplers.LoadData.Load_Extracted_Complex_Data">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Load_Extracted_Complex_Data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">initialdir</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Select the file to load the data from. File format: real left, real right, imag left, imag right and if with_errors==True also background, tab delimited, 2 lines header. </span>

<span class="sd">        Args:</span>
<span class="sd">            filepath (str, optional): if not specified you will be prompted with a filedialoge. Defaults to None.</span>
<span class="sd">            initialdir (str, optional): sets the starting directory for the filedialoge. Defaults to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">initialdir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initialdir</span> <span class="o">=</span> <span class="n">initialdir</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Tk</span><span class="p">()</span>
        <span class="n">root</span><span class="o">.</span><span class="n">withdraw</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">filepath</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">initialdir</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">filepath</span> <span class="o">=</span> <span class="n">filedialog</span><span class="o">.</span><span class="n">askopenfilename</span><span class="p">(</span><span class="n">initialdir</span><span class="o">=</span><span class="n">this_files_path</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">filepath</span> <span class="o">=</span> <span class="n">filedialog</span><span class="o">.</span><span class="n">askopenfilename</span><span class="p">(</span><span class="n">initialdir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">this_files_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">initialdir</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filepath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">datafile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">real_left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">datafile</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">skip_header</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">datafile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">datafile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">real_right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">datafile</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">skip_header</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">datafile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">with_errors</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">datafile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">real_background</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">datafile</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">skip_header</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">datafile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">datafile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">imag_left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">datafile</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">skip_header</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
            <span class="n">datafile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">datafile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">imag_right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">datafile</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">skip_header</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
            <span class="n">datafile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">datafile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">imag_background</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">datafile</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">skip_header</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
            <span class="n">datafile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

    
<div class="viewcode-block" id="LoadData.Cut_Data">
<a class="viewcode-back" href="../../snom_analysis.html#snom_analysis.chiralcouplers.LoadData.Cut_Data">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Cut_Data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">length</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="mi">4000</span><span class="p">,</span> <span class="n">from_where</span><span class="o">=</span><span class="s1">&#39;beginning&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This method will cut the loaded profiles to a specific length.</span>
<span class="sd">        Only used for comsol data to remove the strong oscillations in the beginning.</span>

<span class="sd">        Args:</span>
<span class="sd">            length  (float, optional): length in nm to remove from the profiles. Careful, the definition of the pixelsize must be correct! Defaults to 4000.</span>
<span class="sd">            from_where (str, optional): from where to remove the specified length, can be either be &#39;beginning&#39; to remove from the beginning or &#39;end&#39; to remove from the end.</span>
<span class="sd">                Defaults to &#39;beginning&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">datapoints</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">amplitude_left</span><span class="p">)</span>
        <span class="n">reduced_datapoinst</span> <span class="o">=</span> <span class="n">datapoints</span><span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="n">length</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelsize</span><span class="p">)</span>
        <span class="n">amplitude_left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">reduced_datapoinst</span><span class="p">)</span>
        <span class="n">amplitude_right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">reduced_datapoinst</span><span class="p">)</span>
        <span class="n">phase_left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">reduced_datapoinst</span><span class="p">)</span>
        <span class="n">phase_right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">reduced_datapoinst</span><span class="p">)</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">datapoints</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">from_where</span> <span class="o">==</span> <span class="s1">&#39;beginning&#39;</span> <span class="ow">and</span> <span class="n">i</span><span class="o">&gt;=</span><span class="n">length</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelsize</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">from_where</span> <span class="o">==</span> <span class="s1">&#39;end&#39;</span> <span class="ow">and</span> <span class="n">i</span><span class="o">&lt;=</span><span class="p">(</span><span class="n">datapoints</span><span class="o">-</span><span class="n">length</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelsize</span><span class="p">)):</span>
                <span class="n">amplitude_left</span><span class="p">[</span><span class="n">count</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">amplitude_left</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">amplitude_right</span><span class="p">[</span><span class="n">count</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">amplitude_right</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">phase_left</span><span class="p">[</span><span class="n">count</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase_left</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">phase_right</span><span class="p">[</span><span class="n">count</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase_left</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">amplitude_left</span> <span class="o">=</span> <span class="n">amplitude_left</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">amplitude_right</span> <span class="o">=</span> <span class="n">amplitude_right</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phase_left</span> <span class="o">=</span> <span class="n">phase_left</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phase_right</span> <span class="o">=</span> <span class="n">phase_right</span></div>


<div class="viewcode-block" id="LoadData.Fit_Amplitudes">
<a class="viewcode-back" href="../../snom_analysis.html#snom_analysis.chiralcouplers.LoadData.Fit_Amplitudes">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Fit_Amplitudes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">with_oscillation</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">full_integration</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This function fits the amplitude data from the loaded profiles.</span>
<span class="sd">        The data is fitted with exponential function to extract the propagation length and the directionality.</span>
<span class="sd">        The directionalities are saved in the instance variable all_directionalitys. This contains the directionality and an error estimate.</span>
<span class="sd">        Repeated calls of Load_Extracted_Data and Fit_Amplitudes will create a list of directionalites, which can then be saved for a parameter variation.</span>

<span class="sd">        Args:</span>
<span class="sd">            with_oscillation (bool, optional): ties to fit the exponential additionally with a decaying oscillation. Defaults to False.</span>
<span class="sd">            show_plot (bool, optional): Do you want to display the fit to the amplitude data? Defaults to False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Tk</span><span class="p">()</span>
        <span class="n">root</span><span class="o">.</span><span class="n">withdraw</span><span class="p">()</span>  
        <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">amplitude_left</span><span class="p">))</span>      
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelsize</span><span class="o">*</span><span class="mf">0.001</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">amplitude_left</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;leftwg&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:blue&#39;</span><span class="p">)</span> <span class="c1"># convert pixels to distance in µm</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelsize</span><span class="o">*</span><span class="mf">0.001</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">amplitude_right</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;rightwg&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:orange&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">with_oscillation</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.29</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">]</span>
            <span class="c1"># bounds = ([0, -100], [100, 100])</span>
            <span class="n">coeff_leftwg</span><span class="p">,</span> <span class="n">var_matrix</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">Damped_Exponenial_Function</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">amplitude_left</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="n">p0</span><span class="p">)</span>
            <span class="n">coeff_rightwg</span><span class="p">,</span> <span class="n">var_matrix</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">Damped_Exponenial_Function</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">amplitude_left</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="n">p0</span><span class="p">)</span>
            <span class="c1"># plt.plot(x, Damped_Oscillation_Function(x, 0.1, 0.29, 0, 0.04)+Exponenial_Function(x, 0.2, 0.01, 0))</span>
            <span class="c1"># plt.plot(x, Damped_Exponenial_Function(x, 0.2, 50, 0.1, 0.29, 0, 0.04), label=&#39;initial_guess&#39;)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Damped_Exponenial_Function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">coeff_leftwg</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coeff_leftwg</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">coeff_leftwg</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">coeff_leftwg</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">coeff_leftwg</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">coeff_leftwg</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;fit_leftwg&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:blue&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Damped_Exponenial_Function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">coeff_rightwg</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coeff_rightwg</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">coeff_rightwg</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">coeff_rightwg</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">coeff_rightwg</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">coeff_rightwg</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;fit_rightwg&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:orange&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;oscillation period leftwg = &#39;</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">coeff_leftwg</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span><span class="o">*</span><span class="n">coeff_leftwg</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelsize</span><span class="p">,</span> <span class="s1">&#39; nm&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;oscillation period rightwg = &#39;</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">coeff_rightwg</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span><span class="o">*</span><span class="n">coeff_rightwg</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelsize</span><span class="p">,</span> <span class="s1">&#39; nm&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># p0 = [1, 50*scaling, 0]</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixelsize</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">coeff_leftwg</span><span class="p">,</span> <span class="n">var_matrix</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">Exponenial_Function</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">amplitude_left</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="n">p0</span><span class="p">)</span>
            <span class="n">coeff_rightwg</span><span class="p">,</span> <span class="n">var_matrix</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">Exponenial_Function</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">amplitude_right</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="n">p0</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;offset leftwg: &#39;</span><span class="p">,</span> <span class="n">coeff_leftwg</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;offset rightwg: &#39;</span><span class="p">,</span> <span class="n">coeff_rightwg</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="c1"># plt.plot(x,leftwg, label=&#39;leftwg&#39;, color=&#39;tab:blue&#39;)</span>
            <span class="c1"># plt.plot(x,rightwg, label=&#39;rightwg&#39;, color=&#39;tab:orange&#39;)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelsize</span><span class="o">*</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">Exponenial_Function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">coeff_leftwg</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coeff_leftwg</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">coeff_leftwg</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;fit_leftwg&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:blue&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelsize</span><span class="o">*</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">Exponenial_Function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">coeff_rightwg</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coeff_rightwg</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">coeff_rightwg</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;fit_rightwg&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:orange&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;propagation length leftwg = &#39;</span><span class="p">,</span> <span class="n">coeff_leftwg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelsize</span><span class="p">,</span> <span class="s1">&#39; nm&#39;</span><span class="p">)</span> 
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;propagation length rightwg = &#39;</span><span class="p">,</span> <span class="n">coeff_rightwg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelsize</span><span class="p">,</span> <span class="s1">&#39; nm&#39;</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">all_propagation_lengths</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">coeff_leftwg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelsize</span><span class="p">,</span> <span class="n">coeff_rightwg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelsize</span><span class="p">])</span>
        <span class="c1"># calculate area under exp. function from 0 to inf for left and right wg:</span>
        <span class="k">if</span> <span class="n">full_integration</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">area_left</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">coeff_leftwg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">coeff_leftwg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">area_right</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">coeff_rightwg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">coeff_rightwg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># alternative: calculate area only in interval given by the data </span>
            <span class="n">L</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">area_left</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">coeff_leftwg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">coeff_leftwg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">L</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">coeff_leftwg</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
            <span class="n">area_right</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">coeff_rightwg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">coeff_rightwg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">L</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">coeff_rightwg</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chirality</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">directionality</span> <span class="o">=</span> <span class="p">(</span><span class="n">area_right</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">area_left</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">area_right</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">chirality</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">directionality</span> <span class="o">=</span> <span class="p">(</span><span class="n">area_left</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">area_left</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">area_right</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">with_errors</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1">#sum all background amplitudes to get background area</span>
            <span class="n">background</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">amp_background</span><span class="p">)</span> <span class="c1"># for now the uncertainty for left and right is just the background sum</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chirality</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">directionality_error</span> <span class="o">=</span> <span class="n">Get_Directionality_Uncertainity</span><span class="p">(</span><span class="n">area_right</span><span class="p">,</span> <span class="n">background</span><span class="p">,</span> <span class="n">area_left</span><span class="p">,</span> <span class="n">background</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">chirality</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">directionality_error</span> <span class="o">=</span> <span class="n">Get_Directionality_Uncertainity</span><span class="p">(</span><span class="n">area_left</span><span class="p">,</span> <span class="n">background</span><span class="p">,</span> <span class="n">area_right</span><span class="p">,</span> <span class="n">background</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">all_directionalitys</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">directionality</span><span class="p">,</span> <span class="n">directionality_error</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">all_directionalitys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">directionality</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Get_Measured_Directionality</span><span class="p">()</span>
        <span class="c1"># print(coeff)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$x \ [µm]$&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$abs(E_z) \ [a.u.]$&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">show_plot</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span></div>


<div class="viewcode-block" id="LoadData.Fit_Realpart">
<a class="viewcode-back" href="../../snom_analysis.html#snom_analysis.chiralcouplers.LoadData.Fit_Realpart">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Fit_Realpart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This function fits the real data from the loaded profiles.</span>
<span class="sd">        The data is fitted with exponentially decaying oscillation to extract the directionality.</span>
<span class="sd">        The directionalities are saved in the instance variable all_directionalitys. This contains the directionality and an error estimate.</span>
<span class="sd">        Repeated calls of Load_Extracted_Data and Fit_Realpart will create a list of directionalites, which can then be saved for a parameter variation.</span>

<span class="sd">        Args:</span>
<span class="sd">            show_plot (bool, optional): Do you want to display the fit to the amplitude data? Defaults to False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Tk</span><span class="p">()</span>
        <span class="n">root</span><span class="o">.</span><span class="n">withdraw</span><span class="p">()</span>  
        <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">amplitude_left</span><span class="p">))</span>      
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelsize</span><span class="o">*</span><span class="mf">0.001</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">amplitude_left</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;leftwg&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:blue&#39;</span><span class="p">)</span> <span class="c1"># convert pixels to distance in µm</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelsize</span><span class="o">*</span><span class="mf">0.001</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">amplitude_right</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;rightwg&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:orange&#39;</span><span class="p">)</span>
        <span class="c1"># plt.plot(x*self.pixelsize*0.001, Damped_Oscillation_Function(x, 0.03, 0.075, 0, 0.015), color=&#39;blue&#39;)</span>
        <span class="c1"># plt.plot(x*self.pixelsize*0.001, Damped_Oscillation_Function(x, 0.03, 0.077, 0, 0.015), color=&#39;red&#39;)</span>
        <span class="c1"># plt.plot(x*self.pixelsize*0.001, Damped_Oscillation_Function(x, 0.03, 0.079, 0, 0.015), color=&#39;green&#39;)</span>
        <span class="c1"># plt.plot(x*self.pixelsize*0.001, Damped_Oscillation_Function(x, 0.03, 0.085, 0, 0.015), color=&#39;yellow&#39;)</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.077</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.015</span><span class="p">]</span>
        <span class="n">coeff_leftwg</span><span class="p">,</span> <span class="n">pcov_left</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">Damped_Oscillation_Function</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">amplitude_left</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="n">p0</span><span class="p">)</span>
        <span class="n">coeff_rightwg</span><span class="p">,</span> <span class="n">pcov_right</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">Damped_Oscillation_Function</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">amplitude_right</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="n">p0</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelsize</span><span class="o">*</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">Damped_Oscillation_Function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">coeff_leftwg</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coeff_leftwg</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">coeff_leftwg</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">coeff_leftwg</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;fit_leftwg&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:blue&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelsize</span><span class="o">*</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">Damped_Oscillation_Function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">coeff_rightwg</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coeff_rightwg</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">coeff_rightwg</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">coeff_rightwg</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;fit_rightwg&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:orange&#39;</span><span class="p">)</span>
        <span class="n">perr_left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">pcov_left</span><span class="p">))</span>
        <span class="n">perr_right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">pcov_right</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Errors: </span><span class="si">{</span><span class="n">perr_left</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">perr_right</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="c1"># p0 = [1, self.pixelsize, 0]</span>
        <span class="c1"># coeff_leftwg, var_matrix = curve_fit(Damped_Oscillation_Function, x, self.amplitude_left, p0=p0)</span>
        <span class="c1"># coeff_rightwg, var_matrix = curve_fit(Damped_Oscillation_Function, x, self.amplitude_right, p0=p0)</span>
        <span class="c1"># print(&#39;offset leftwg: &#39;, coeff_leftwg[2])</span>
        <span class="c1"># print(&#39;offset rightwg: &#39;, coeff_rightwg[2])</span>
        <span class="c1"># plt.plot(x,leftwg, label=&#39;leftwg&#39;, color=&#39;tab:blue&#39;)</span>
        <span class="c1"># plt.plot(x,rightwg, label=&#39;rightwg&#39;, color=&#39;tab:orange&#39;)</span>
        <span class="c1"># plt.plot(x*self.pixelsize*0.001, Damped_Oscillation_Function(x, coeff_leftwg[0], coeff_leftwg[1], coeff_leftwg[2]), &#39;--&#39;, label=&#39;fit_leftwg&#39;, color=&#39;tab:blue&#39;)</span>
        <span class="c1"># plt.plot(x*self.pixelsize*0.001, Damped_Oscillation_Function(x, coeff_rightwg[0], coeff_rightwg[1], coeff_rightwg[2]), &#39;--&#39;, label=&#39;fit_rightwg&#39;, color=&#39;tab:orange&#39;)</span>
        
        <span class="c1"># print(&#39;propagation length leftwg = &#39;, coeff_leftwg[1]*self.pixelsize, &#39; nm&#39;) </span>
        <span class="c1"># print(&#39;propagation length rightwg = &#39;, coeff_rightwg[1]*self.pixelsize, &#39; nm&#39;) </span>
        <span class="c1"># self.all_propagation_lengths.append([coeff_leftwg[1]*self.pixelsize, coeff_rightwg[1]*self.pixelsize])</span>
        <span class="c1"># calculate area under exp. function from 0 to inf for left and right wg:</span>

        <span class="c1"># get amplitude from fit coeff</span>
        <span class="n">amp_left</span> <span class="o">=</span> <span class="n">coeff_leftwg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">amp_right</span> <span class="o">=</span> <span class="n">coeff_rightwg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chirality</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">directionality</span> <span class="o">=</span> <span class="p">(</span><span class="n">amp_right</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">amp_left</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">amp_right</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">chirality</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">directionality</span> <span class="o">=</span> <span class="p">(</span><span class="n">amp_left</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">amp_left</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">amp_right</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Directionality = </span><span class="si">{</span><span class="n">directionality</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">with_errors</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># sum all background amplitudes to get background area</span>
            <span class="n">background</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">amp_background</span><span class="p">)</span> <span class="c1"># for now the uncertainty for left and right is just the background sum</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Background: &#39;</span><span class="p">,</span> <span class="n">background</span><span class="p">)</span>
            <span class="c1"># uncertainty on amplitude from fit roughly factor of 10 more than background. Use fit uncert...</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chirality</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># directionality_error = Get_Directionality_Uncertainity(amp_right, background, amp_left, background)</span>
                <span class="n">directionality_error</span> <span class="o">=</span> <span class="n">Get_Directionality_Uncertainity</span><span class="p">(</span><span class="n">amp_right</span><span class="p">,</span> <span class="n">perr_right</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">amp_left</span><span class="p">,</span> <span class="n">perr_left</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">chirality</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="c1"># directionality_error = Get_Directionality_Uncertainity(amp_left, background, amp_right, background)</span>
                <span class="n">directionality_error</span> <span class="o">=</span> <span class="n">Get_Directionality_Uncertainity</span><span class="p">(</span><span class="n">amp_left</span><span class="p">,</span> <span class="n">perr_left</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">amp_right</span><span class="p">,</span> <span class="n">perr_right</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">all_directionalitys</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">directionality</span><span class="p">,</span> <span class="n">directionality_error</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">all_directionalitys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">directionality</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Get_Measured_Directionality</span><span class="p">()</span>
        <span class="c1"># print(coeff)</span>
        
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$x [µm]$&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$Re(E_z) [a.u.]$&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">show_plot</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span></div>

    
<div class="viewcode-block" id="LoadData.Fit_Complex_Data">
<a class="viewcode-back" href="../../snom_analysis.html#snom_analysis.chiralcouplers.LoadData.Fit_Complex_Data">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Fit_Complex_Data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">polar_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This function fits the real data from the loaded profiles.</span>
<span class="sd">        The data is fitted with exponentially decaying oscillation to extract the directionality.</span>
<span class="sd">        The directionalities are saved in the instance variable all_directionalitys. This contains the directionality and an error estimate.</span>
<span class="sd">        Repeated calls of Load_Extracted_Data and Fit_Realpart will create a list of directionalites, which can then be saved for a parameter variation.</span>

<span class="sd">        Args:</span>
<span class="sd">            show_plot (bool, optional): Do you want to display the fit to the amplitude data? Defaults to False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Tk</span><span class="p">()</span>
        <span class="n">root</span><span class="o">.</span><span class="n">withdraw</span><span class="p">()</span>  
        <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">real_left</span><span class="p">))</span>      
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelsize</span><span class="o">*</span><span class="mf">0.001</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">real_left</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;leftwg&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:blue&#39;</span><span class="p">)</span> <span class="c1"># convert pixels to distance in µm</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelsize</span><span class="o">*</span><span class="mf">0.001</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">real_right</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;rightwg&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:orange&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelsize</span><span class="o">*</span><span class="mf">0.001</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">imag_left</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;leftwg&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:red&#39;</span><span class="p">)</span> <span class="c1"># convert pixels to distance in µm</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelsize</span><span class="o">*</span><span class="mf">0.001</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">imag_right</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;rightwg&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:purple&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">amplitude_left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">real_left</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">imag_left</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">amplitude_right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">real_right</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">imag_right</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">amp_background</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">real_background</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">imag_background</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelsize</span><span class="o">*</span><span class="mf">0.001</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">amplitude_left</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;leftwg&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:olive&#39;</span><span class="p">)</span> <span class="c1"># convert pixels to distance in µm</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelsize</span><span class="o">*</span><span class="mf">0.001</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">amplitude_right</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;rightwg&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:cyan&#39;</span><span class="p">)</span>
        
        <span class="n">p0</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.077</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.015</span><span class="p">]</span>
        <span class="n">real_coeff_leftwg</span><span class="p">,</span> <span class="n">real_pcov_left</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">Damped_Oscillation_Function</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">real_left</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="n">p0</span><span class="p">)</span>
        <span class="n">real_coeff_rightwg</span><span class="p">,</span> <span class="n">real_pcov_right</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">Damped_Oscillation_Function</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">real_right</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="n">p0</span><span class="p">)</span>
        <span class="n">imag_coeff_leftwg</span><span class="p">,</span> <span class="n">imag_pcov_left</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">Damped_Oscillation_Function</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">imag_left</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="n">p0</span><span class="p">)</span>
        <span class="n">imag_coeff_rightwg</span><span class="p">,</span> <span class="n">imag_pcov_right</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">Damped_Oscillation_Function</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">imag_right</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="n">p0</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelsize</span><span class="o">*</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">Damped_Oscillation_Function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">real_coeff_leftwg</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">real_coeff_leftwg</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">real_coeff_leftwg</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">real_coeff_leftwg</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;fit_leftwg&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:blue&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelsize</span><span class="o">*</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">Damped_Oscillation_Function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">real_coeff_rightwg</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">real_coeff_rightwg</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">real_coeff_rightwg</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">real_coeff_rightwg</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;fit_rightwg&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:orange&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelsize</span><span class="o">*</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">Damped_Oscillation_Function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">imag_coeff_leftwg</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">imag_coeff_leftwg</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">imag_coeff_leftwg</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">imag_coeff_leftwg</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;fit_leftwg&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:red&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelsize</span><span class="o">*</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">Damped_Oscillation_Function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">imag_coeff_rightwg</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">imag_coeff_rightwg</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">imag_coeff_rightwg</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">imag_coeff_rightwg</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;fit_rightwg&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:purple&#39;</span><span class="p">)</span>
        <span class="n">real_perr_left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">real_pcov_left</span><span class="p">))</span>
        <span class="n">real_perr_right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">real_pcov_right</span><span class="p">))</span>
        <span class="n">imag_perr_left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">imag_pcov_left</span><span class="p">))</span>
        <span class="n">imag_perr_right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">imag_pcov_right</span><span class="p">))</span>


        <span class="n">amplitude_from_fit_leftwg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Damped_Oscillation_Function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">real_coeff_leftwg</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">real_coeff_leftwg</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">real_coeff_leftwg</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">real_coeff_leftwg</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">Damped_Oscillation_Function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">imag_coeff_leftwg</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">imag_coeff_leftwg</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">imag_coeff_leftwg</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">imag_coeff_leftwg</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">amplitude_from_fit_rightwg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Damped_Oscillation_Function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">real_coeff_rightwg</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">real_coeff_rightwg</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">real_coeff_rightwg</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">real_coeff_rightwg</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">Damped_Oscillation_Function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">imag_coeff_rightwg</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">imag_coeff_rightwg</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">imag_coeff_rightwg</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">imag_coeff_rightwg</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelsize</span><span class="o">*</span><span class="mf">0.001</span><span class="p">,</span><span class="n">amplitude_from_fit_leftwg</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;leftwg&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:olive&#39;</span><span class="p">)</span> <span class="c1"># convert pixels to distance in µm</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelsize</span><span class="o">*</span><span class="mf">0.001</span><span class="p">,</span><span class="n">amplitude_from_fit_rightwg</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;rightwg&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:cyan&#39;</span><span class="p">)</span>

        <span class="c1"># get real from fit coeff</span>
        <span class="n">amp_left</span> <span class="o">=</span> <span class="n">real_coeff_leftwg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">amp_right</span> <span class="o">=</span> <span class="n">real_coeff_rightwg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># alternative get amp from sum of amplitudes (from overlay of real and imag)</span>
        <span class="n">sum_left</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">amplitude_from_fit_leftwg</span><span class="p">)</span>
        <span class="n">sum_right</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">amplitude_from_fit_rightwg</span><span class="p">)</span>
        <span class="c1"># overwrite amp from fitparameter</span>
        <span class="n">amp_left</span> <span class="o">=</span> <span class="n">sum_left</span>
        <span class="n">amp_right</span> <span class="o">=</span> <span class="n">sum_right</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chirality</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">directionality</span> <span class="o">=</span> <span class="p">(</span><span class="n">amp_right</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">amp_left</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">amp_right</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">chirality</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">directionality</span> <span class="o">=</span> <span class="p">(</span><span class="n">amp_left</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">amp_left</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">amp_right</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Directionality = </span><span class="si">{</span><span class="n">directionality</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">with_errors</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># sum all background reals to get background area</span>
            <span class="n">real_background</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">real_background</span><span class="p">)</span> <span class="c1"># for now the uncertainty for left and right is just the background sum</span>
            <span class="n">imag_background</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imag_background</span><span class="p">)</span> <span class="c1"># for now the uncertainty for left and right is just the background sum</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Background: &#39;</span><span class="p">,</span> <span class="n">real_background</span><span class="p">)</span>
            <span class="c1"># uncertainty on real from fit roughly factor of 10 more than background. Use fit uncert...</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chirality</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># directionality_error = Get_Directionality_Uncertainity(amp_right, background, amp_left, background)</span>
                <span class="n">directionality_error</span> <span class="o">=</span> <span class="n">Get_Directionality_Uncertainity</span><span class="p">(</span><span class="n">amp_right</span><span class="p">,</span> <span class="n">real_perr_right</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">amp_left</span><span class="p">,</span> <span class="n">real_perr_left</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">chirality</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="c1"># directionality_error = Get_Directionality_Uncertainity(amp_left, background, amp_right, background)</span>
                <span class="n">directionality_error</span> <span class="o">=</span> <span class="n">Get_Directionality_Uncertainity</span><span class="p">(</span><span class="n">amp_left</span><span class="p">,</span> <span class="n">real_perr_left</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">amp_right</span><span class="p">,</span> <span class="n">real_perr_right</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">all_directionalitys</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">directionality</span><span class="p">,</span> <span class="n">directionality_error</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">all_directionalitys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">directionality</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Get_Measured_Directionality</span><span class="p">()</span> <span class="c1"># calculates directionality from the amplitude which was calculated from the real and imag data</span>
        <span class="c1"># print(coeff)</span>
        
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$x [µm]$&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$Re(E_z) [a.u.]$&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">show_plot</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">polar_plot</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># setting the axes</span>
            <span class="c1"># projection as polar</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">projection</span> <span class="o">=</span> <span class="s1">&#39;polar&#39;</span><span class="p">)</span>
            
            <span class="c1"># creating an array</span>
            <span class="c1"># containing the radian values</span>
            <span class="c1"># rads = np.arange(0, 2 * np.pi, 0.001) </span>
            <span class="n">radii</span> <span class="o">=</span> <span class="n">amplitude_from_fit_leftwg</span>
            <span class="n">radii_right</span> <span class="o">=</span> <span class="n">amplitude_from_fit_rightwg</span>
            <span class="c1"># np.sqrt(1-gamma**2)*omega_0*t = 2*pi</span>
            <span class="n">tmax</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">omega_0</span> <span class="o">=</span> <span class="n">real_coeff_leftwg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;omega_0: &#39;</span><span class="p">,</span> <span class="n">omega_0</span><span class="p">)</span>
            <span class="c1"># n_periods = tmax/omega_0/(2*np.pi)</span>
            <span class="n">n_periods</span> <span class="o">=</span> <span class="mi">6</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;number of periods: &#39;</span><span class="p">,</span> <span class="n">n_periods</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;len(x): &#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
            <span class="c1"># rads = np.arange(0, n_periods*2 * np.pi, 0.01)</span>
            <span class="n">rads</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_periods</span><span class="o">*</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
            <span class="n">rads_right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">n_periods</span><span class="o">*</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">+</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">rads</span><span class="p">)</span>
            
            <span class="c1"># plotting the spiral</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rads</span><span class="p">)):</span>
                <span class="n">rad</span> <span class="o">=</span> <span class="n">rads</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="c1"># print(rad)</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">radii</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">r_right</span> <span class="o">=</span> <span class="n">radii_right</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="c1"># print(r)</span>
                <span class="c1"># r = rad</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">polar</span><span class="p">(</span><span class="n">rad</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="s1">&#39;g.&#39;</span><span class="p">)</span>
                <span class="c1"># plt.polar(rad, amplitude_left[i], &#39;g.&#39;)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">polar</span><span class="p">(</span><span class="n">rads_right</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">r_right</span><span class="p">,</span> <span class="s1">&#39;r.&#39;</span><span class="p">)</span>
                <span class="c1"># plt.polar(rad, amplitude_right[i], &#39;r.&#39;)</span>
                
            <span class="c1"># display the polar plot</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_Get_Measured_Directionality</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># make shure data is only positive, so it also works for realpart</span>
        <span class="n">left_data</span> <span class="o">=</span> <span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">element</span><span class="p">)</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">amplitude_left</span><span class="p">]</span>
        <span class="n">right_data</span> <span class="o">=</span> <span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">element</span><span class="p">)</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">amplitude_right</span><span class="p">]</span>
        <span class="n">left_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">left_data</span><span class="p">)</span>
        <span class="n">right_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">right_data</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chirality</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">directionality</span> <span class="o">=</span> <span class="p">(</span><span class="n">right_sum</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">left_sum</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">right_sum</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">chirality</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">directionality</span> <span class="o">=</span> <span class="p">(</span><span class="n">left_sum</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">left_sum</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">right_sum</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">with_errors</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1">#sum all background amplitudes to get background area</span>
            <span class="n">background</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">amp_background</span><span class="p">)</span> <span class="c1"># for now the uncertainty for left and right is just the background sum</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chirality</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">directionality_error</span> <span class="o">=</span> <span class="n">Get_Directionality_Uncertainity</span><span class="p">(</span><span class="n">right_sum</span><span class="p">,</span> <span class="n">background</span><span class="p">,</span> <span class="n">left_sum</span><span class="p">,</span> <span class="n">background</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">chirality</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">directionality_error</span> <span class="o">=</span> <span class="n">Get_Directionality_Uncertainity</span><span class="p">(</span><span class="n">left_sum</span><span class="p">,</span> <span class="n">background</span><span class="p">,</span> <span class="n">right_sum</span><span class="p">,</span> <span class="n">background</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">all_measured_directionalities</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">directionality</span><span class="p">,</span> <span class="n">directionality_error</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">all_measured_directionalities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">directionality</span><span class="p">)</span>

<div class="viewcode-block" id="LoadData.Plot_Propagation_Lengths">
<a class="viewcode-back" href="../../snom_analysis.html#snom_analysis.chiralcouplers.LoadData.Plot_Propagation_Lengths">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Plot_Propagation_Lengths</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x_values</span><span class="p">:</span><span class="nb">list</span><span class="p">,</span> <span class="n">x_label</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This function will plot all propagation lengths in memory, only useful if multiple measurement profiles have been loaded and fitted.</span>

<span class="sd">        Args:</span>
<span class="sd">            x_values (list): a predefined list of x-values. This would for example be a list of radii when you want to display the data of a radius variation.</span>
<span class="sd">            x_label (_type_): label for the x-axis</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">propagation_lengths_leftwg</span> <span class="o">=</span> <span class="p">[</span><span class="n">element</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mf">0.001</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_propagation_lengths</span><span class="p">]</span>
        <span class="n">propagation_lengths_rightwg</span> <span class="o">=</span> <span class="p">[</span><span class="n">element</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mf">0.001</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_propagation_lengths</span><span class="p">]</span>
        
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_values</span><span class="p">,</span> <span class="n">propagation_lengths_leftwg</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:blue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;leftwg&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_values</span><span class="p">,</span> <span class="n">propagation_lengths_rightwg</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:orange&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;rightwg&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">x_label</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Propagation Length [µm]&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

        <span class="c1"># fig, ax = plt.subplots()</span>
    
<div class="viewcode-block" id="LoadData.Plot_Directionality">
<a class="viewcode-back" href="../../snom_analysis.html#snom_analysis.chiralcouplers.LoadData.Plot_Directionality">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Plot_Directionality</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x_values</span><span class="p">,</span> <span class="n">x_label</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">with_errors</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">measured_directionalities</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_measured_directionalities</span><span class="p">]</span>
            <span class="n">yerr</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_measured_directionalities</span><span class="p">]</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x_values</span><span class="p">,</span> <span class="n">measured_directionalities</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">yerr</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:blue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;from data&#39;</span><span class="p">)</span>
            <span class="n">fit_directionalities</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_directionalitys</span><span class="p">]</span>
            <span class="n">yerr</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_directionalitys</span><span class="p">]</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x_values</span><span class="p">,</span> <span class="n">fit_directionalities</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">yerr</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:orange&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;from fit&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_measured_directionalities</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:blue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;from data&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_directionalitys</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:orange&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;from fit&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">x_label</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Directionality [a.u.]&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="LoadData.Export_Directionalities">
<a class="viewcode-back" href="../../snom_analysis.html#snom_analysis.chiralcouplers.LoadData.Export_Directionalities">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Export_Directionalities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datapoints</span><span class="p">:</span><span class="nb">list</span><span class="p">,</span> <span class="n">filepath</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">variation_type</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s1">&#39;radius&#39;</span><span class="p">,</span> <span class="n">data_type</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s1">&#39;snom&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This method will export the created list of directionalities to a .txt file.</span>

<span class="sd">        Args:</span>
<span class="sd">            datapoints (list): list of the parameters which were varied in this measurement sequence</span>
<span class="sd">            filepath (str): complete filepath with &#39;.txt&#39; ending for the directionalities list.</span>
<span class="sd">            variation_type (str, optional): will be included in file header. Defaults to &#39;radius&#39;.</span>
<span class="sd">            data_type (str, optional): either &#39;snom&#39; or &#39;comsol&#39;. Defaults to &#39;snom&#39;. For &#39;snom&#39; the directionalities from the exponential fit will be used,</span>
<span class="sd">                for &#39;comsol&#39; the sum of the data will be used, since sometimes the field is so weak that the fit does not work properly.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">with_errors</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">variation_type</span><span class="si">}</span><span class="se">\t</span><span class="s1">fit_directionality</span><span class="se">\t</span><span class="s1">uncertainty</span><span class="se">\t</span><span class="s1">sum_directionality</span><span class="se">\t</span><span class="s1">uncertainty</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">datapoints</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s1">&#39;snom&#39;</span><span class="p">:</span>
                    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">datapoints</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">all_directionalitys</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">all_directionalitys</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">all_measured_directionalities</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">all_measured_directionalities</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="c1"># export values from fitcomparison, because data is very noisy</span>
                <span class="k">elif</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s1">&#39;comsol&#39;</span><span class="p">:</span>
                    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">datapoints</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">all_measured_directionalities</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="c1"># export amplitude comparison, because fit for low intensity wg does not work properly</span>
            <span class="n">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">variation_type</span><span class="si">}</span><span class="se">\t</span><span class="s1">directionality</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">datapoints</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s1">&#39;snom&#39;</span><span class="p">:</span>
                    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">datapoints</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">all_directionalitys</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="c1"># export values from fitcomparison, because data is very noisy</span>
                <span class="k">elif</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s1">&#39;comsol&#39;</span><span class="p">:</span>
                    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">datapoints</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">all_measured_directionalities</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="c1"># export amplitude comparison, because fit for low intensity wg does not work properly</span>
            <span class="n">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<div class="viewcode-block" id="LoadData.Plot_Phase_Gradient">
<a class="viewcode-back" href="../../snom_analysis.html#snom_analysis.chiralcouplers.LoadData.Plot_Phase_Gradient">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Plot_Phase_Gradient</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Displays the phase in several ways like raw, corrected, flattened with fit, phase difference between left and right wg and varaiations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_left</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_values</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelsize</span><span class="o">*</span><span class="mf">0.001</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase_left</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:blue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;leftwg&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_values</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelsize</span><span class="o">*</span><span class="mf">0.001</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase_right</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:orange&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;rightwg&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;X [µm]&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Phase&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="n">phase_left_cleaned</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Remove_Artificial_Phase</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_left</span><span class="p">)</span>
        <span class="n">phase_right_cleaned</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Remove_Artificial_Phase</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_right</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_values</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelsize</span><span class="o">*</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">phase_left_cleaned</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:blue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;leftwg cleaned + flattened&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_values</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelsize</span><span class="o">*</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">phase_right_cleaned</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:orange&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;rightwg cleaned + flattened&#39;</span><span class="p">)</span>
        <span class="c1"># plt.title(self.title)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;X [µm]&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Phase&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="n">difference</span> <span class="o">=</span> <span class="n">Get_Profile_Difference</span><span class="p">(</span><span class="n">phase_left_cleaned</span><span class="p">,</span> <span class="n">phase_right_cleaned</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_values</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelsize</span><span class="o">*</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">difference</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Phase difference&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;X [µm]&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Phase difference&#39;</span><span class="p">)</span>
        <span class="n">mean_difference</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">difference</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mean_difference</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span> 
            <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">((</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">mean_difference</span> <span class="o">&gt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="c1"># fit flattened phase profiles</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="c1"># bounds = ([0, -100], [100, 100])</span>
        <span class="n">coeff_left</span><span class="p">,</span> <span class="n">pcov_left</span> <span class="o">=</span> <span class="n">Fit_Linear_Function</span><span class="p">(</span><span class="n">phase_left_cleaned</span><span class="p">,</span> <span class="n">p0</span><span class="p">)</span>
        <span class="n">coeff_right</span><span class="p">,</span> <span class="n">pcov_right</span> <span class="o">=</span> <span class="n">Fit_Linear_Function</span><span class="p">(</span><span class="n">phase_right_cleaned</span><span class="p">,</span> <span class="n">p0</span><span class="p">)</span>
        <span class="c1"># perr_left = np.sqrt(np.diag(pcov_left))</span>
        <span class="c1"># perr_right = np.sqrt(np.diag(pcov_right))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_values</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelsize</span><span class="o">*</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">phase_left_cleaned</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:blue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;leftwg cleaned + flattened&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_values</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelsize</span><span class="o">*</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">phase_right_cleaned</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:orange&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;rightwg cleaned + flattened&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_values</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelsize</span><span class="o">*</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">Linear_Function</span><span class="p">(</span><span class="n">x_values</span><span class="p">,</span> <span class="n">coeff_left</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coeff_left</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:blue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;leftwg fit&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_values</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelsize</span><span class="o">*</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">Linear_Function</span><span class="p">(</span><span class="n">x_values</span><span class="p">,</span> <span class="n">coeff_right</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coeff_right</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:orange&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;rightwg fit&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;X [µm]&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Phase&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="n">phase_differece_fit</span> <span class="o">=</span> <span class="n">Linear_Function</span><span class="p">(</span><span class="n">x_values</span><span class="p">,</span> <span class="n">coeff_left</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coeff_left</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="n">Linear_Function</span><span class="p">(</span><span class="n">x_values</span><span class="p">,</span> <span class="n">coeff_right</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coeff_right</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_values</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelsize</span><span class="o">*</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">phase_differece_fit</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:blue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Phase difference from fit&#39;</span><span class="p">)</span>
        <span class="c1"># phase_differece_fit = coeff_left-coeff_right</span>
        <span class="c1"># plt.hlines(phase_differece_fit, color=&#39;tab:blue&#39;, label=&#39;Phase difference from fit&#39;)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_values</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelsize</span><span class="o">*</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">difference</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:orange&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Phase difference&#39;</span><span class="p">)</span>
        <span class="c1"># fit difference with linear function and compare to phase_differece_fit</span>
        <span class="n">coeff_difference</span><span class="p">,</span> <span class="n">pcov_difference</span> <span class="o">=</span> <span class="n">Fit_Linear_Function</span><span class="p">(</span><span class="n">difference</span><span class="p">)</span>
        <span class="c1"># perr_difference = np.sqrt(np.diag(pcov_difference))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_values</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelsize</span><span class="o">*</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">Linear_Function</span><span class="p">(</span><span class="n">x_values</span><span class="p">,</span> <span class="n">coeff_difference</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coeff_difference</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Phase difference fit&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The mean phase difference is: &#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">phase_differece_fit</span><span class="p">))</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;X [µm]&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Phase difference&#39;</span><span class="p">)</span>
        <span class="n">mean_difference</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">difference</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mean_difference</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span> 
            <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">((</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">mean_difference</span> <span class="o">&gt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="c1">#mode index:</span>
        <span class="n">mode_index_left</span> <span class="o">=</span> <span class="n">Get_Modeindex_from_LinearFunction</span><span class="p">(</span><span class="n">coeff_left</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixelsize</span><span class="p">,</span> <span class="n">wavelength</span><span class="o">=</span><span class="mi">1600</span><span class="p">)</span>
        <span class="n">mode_index_right</span> <span class="o">=</span> <span class="n">Get_Modeindex_from_LinearFunction</span><span class="p">(</span><span class="n">coeff_right</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixelsize</span><span class="p">,</span> <span class="n">wavelength</span><span class="o">=</span><span class="mi">1600</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The mode index of the left wg is: &#39;</span><span class="p">,</span> <span class="n">mode_index_left</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The mode index of the right wg is: &#39;</span><span class="p">,</span> <span class="n">mode_index_right</span><span class="p">)</span>

        <span class="c1"># plot phase gradient minus fitfunction to look for oscillations...</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_values</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelsize</span><span class="o">*</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">phase_left_cleaned</span><span class="o">-</span><span class="n">Linear_Function</span><span class="p">(</span><span class="n">x_values</span><span class="p">,</span> <span class="n">coeff_left</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coeff_left</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:blue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;left wg&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_values</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelsize</span><span class="o">*</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">phase_right_cleaned</span><span class="o">-</span><span class="n">Linear_Function</span><span class="p">(</span><span class="n">x_values</span><span class="p">,</span> <span class="n">coeff_right</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coeff_right</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:orange&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;right wg&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;X [µm]&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Phase variation&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_Remove_Artificial_Phase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">phasearray</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="mf">1.7</span><span class="p">):</span>
        <span class="n">new_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">phasearray</span><span class="p">)))</span>
        <span class="n">previous_element</span> <span class="o">=</span> <span class="n">phasearray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">phaseshift</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">phasearray</span><span class="p">)):</span>
            <span class="n">element</span> <span class="o">=</span> <span class="n">phasearray</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">previous_element</span> <span class="o">&gt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mi">2</span><span class="o">-</span><span class="n">bounds</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">element</span> <span class="o">&lt;</span> <span class="n">bounds</span><span class="p">:</span>
                    <span class="n">phaseshift</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mi">2</span>
                    <span class="n">previous_element</span> <span class="o">=</span> <span class="n">element</span>
                    <span class="c1"># print(&#39;in a&#39;)</span>
                <span class="k">elif</span> <span class="n">element</span> <span class="o">&gt;=</span> <span class="n">previous_element</span><span class="p">:</span>
                    <span class="n">previous_element</span> <span class="o">=</span> <span class="n">element</span>
                    <span class="c1"># print(&#39;in b&#39;)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">element</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mi">2</span><span class="c1"># set all phase values on the falling flank to 2pi, as they should not exist </span>
                    <span class="c1"># print(&#39;in c&#39;)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">previous_element</span> <span class="o">=</span> <span class="n">element</span>
            <span class="n">new_array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">element</span> <span class="o">+</span> <span class="n">phaseshift</span>
        <span class="k">return</span> <span class="n">new_array</span></div>


<div class="viewcode-block" id="Flatten_Profile">
<a class="viewcode-back" href="../../snom_analysis.html#snom_analysis.chiralcouplers.Flatten_Profile">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">Flatten_Profile</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">threshold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mf">0.8</span>
    <span class="n">flattened_profile</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">phase_shift</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">threshold</span><span class="p">):</span>
            <span class="n">phase_shift</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mi">2</span>
        <span class="n">flattened_profile</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">phase_shift</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">flattened_profile</span></div>


<div class="viewcode-block" id="Damped_Exponenial_Function">
<a class="viewcode-back" href="../../snom_analysis.html#snom_analysis.chiralcouplers.Damped_Exponenial_Function">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">Damped_Exponenial_Function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">omega_0</span><span class="p">,</span> <span class="n">phase</span><span class="p">,</span> <span class="n">gamma</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Exponenial_Function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span><span class="o">+</span><span class="n">Damped_Oscillation_Function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">omega_0</span><span class="p">,</span> <span class="n">phase</span><span class="p">,</span> <span class="n">gamma</span><span class="p">)</span></div>


<div class="viewcode-block" id="Exponenial_Function">
<a class="viewcode-back" href="../../snom_analysis.html#snom_analysis.chiralcouplers.Exponenial_Function">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">Exponenial_Function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
    <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span><span class="c1">#for now</span>
    <span class="k">return</span> <span class="n">A</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">d</span><span class="p">))</span><span class="o">+</span><span class="n">offset</span> <span class="c1"># this is for the electric field, for intensity the /2 should be removed</span></div>


<div class="viewcode-block" id="Damped_Oscillation_Function">
<a class="viewcode-back" href="../../snom_analysis.html#snom_analysis.chiralcouplers.Damped_Oscillation_Function">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">Damped_Oscillation_Function</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">omega_0</span><span class="p">,</span> <span class="n">phase</span><span class="p">,</span> <span class="n">gamma</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Damped oscillation function</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        A [float]: amplitude of the oscillation</span>
<span class="sd">        period [float]: period of oscillation </span>
<span class="sd">        phase [float]: initial phase of the oscillation</span>
<span class="sd">        gamma [float]: damping factor of the oscillation</span>
<span class="sd">    </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">A</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">gamma</span><span class="o">*</span><span class="n">omega_0</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">gamma</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">omega_0</span><span class="o">*</span><span class="n">t</span> <span class="o">+</span> <span class="n">phase</span><span class="p">)</span></div>


<div class="viewcode-block" id="Fit_Linear_Function">
<a class="viewcode-back" href="../../snom_analysis.html#snom_analysis.chiralcouplers.Fit_Linear_Function">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">Fit_Linear_Function</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">p0</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">bounds</span><span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">coeff</span><span class="p">,</span> <span class="n">var_matrix</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">Linear_Function</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)),</span> <span class="n">data</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="n">p0</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">coeff</span><span class="p">,</span> <span class="n">var_matrix</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">Linear_Function</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)),</span> <span class="n">data</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="n">p0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">coeff</span><span class="p">,</span> <span class="n">var_matrix</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">Linear_Function</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)),</span> <span class="n">data</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">var_matrix</span></div>


<div class="viewcode-block" id="Linear_Function">
<a class="viewcode-back" href="../../snom_analysis.html#snom_analysis.chiralcouplers.Linear_Function">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">Linear_Function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span><span class="o">*</span><span class="n">x</span><span class="o">+</span><span class="n">b</span></div>


<div class="viewcode-block" id="Double_Gauss">
<a class="viewcode-back" href="../../snom_analysis.html#snom_analysis.chiralcouplers.Double_Gauss">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">Double_Gauss</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">mu_1</span><span class="p">,</span> <span class="n">mu_2</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">A</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">mu_1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">mu_2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span> <span class="o">+</span> <span class="n">offset</span></div>


<div class="viewcode-block" id="Sawtooth_v2">
<a class="viewcode-back" href="../../snom_analysis.html#snom_analysis.chiralcouplers.Sawtooth_v2">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">Sawtooth_v2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n_periods</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
    <span class="n">phase_orientation</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">signal</span><span class="o">.</span><span class="n">sawtooth</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">n_periods</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">offset</span><span class="p">),</span> <span class="n">phase_orientation</span><span class="p">))</span></div>


<div class="viewcode-block" id="Sawtooth">
<a class="viewcode-back" href="../../snom_analysis.html#snom_analysis.chiralcouplers.Sawtooth">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">Sawtooth</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">n_periods</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
    <span class="n">phase_orientation</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">signal</span><span class="o">.</span><span class="n">sawtooth</span><span class="p">(</span><span class="n">period</span> <span class="o">*</span> <span class="n">n_periods</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">offset</span><span class="p">),</span> <span class="n">phase_orientation</span><span class="p">))</span></div>



<div class="viewcode-block" id="Get_Smallest_Difference">
<a class="viewcode-back" href="../../snom_analysis.html#snom_analysis.chiralcouplers.Get_Smallest_Difference">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">Get_Smallest_Difference</span><span class="p">(</span><span class="n">value1</span><span class="p">,</span> <span class="n">value2</span><span class="p">):</span>
    <span class="c1"># make shure value1 is smaller than value2</span>
    <span class="n">orientation</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">value1</span> <span class="o">&gt;</span> <span class="n">value2</span><span class="p">:</span>
        <span class="n">copy</span> <span class="o">=</span> <span class="n">value1</span>
        <span class="n">value1</span> <span class="o">=</span> <span class="n">value2</span>
        <span class="n">value2</span> <span class="o">=</span> <span class="n">copy</span>
        <span class="c1"># orientation = -1</span>
    <span class="n">difference</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">value1</span> <span class="o">-</span> <span class="n">value2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">difference</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">:</span>
        <span class="n">difference</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mi">2</span> <span class="o">-</span> <span class="n">difference</span>
    <span class="k">return</span> <span class="n">difference</span><span class="o">*</span><span class="n">orientation</span></div>


<div class="viewcode-block" id="Get_Phase_Difference_V2">
<a class="viewcode-back" href="../../snom_analysis.html#snom_analysis.chiralcouplers.Get_Phase_Difference_V2">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">Get_Phase_Difference_V2</span><span class="p">(</span><span class="n">value1</span><span class="p">,</span> <span class="n">value2</span><span class="p">):</span>
    <span class="n">sign</span> <span class="o">=</span> <span class="o">+</span><span class="mi">1</span>
    <span class="k">if</span> <span class="n">value1</span> <span class="o">&gt;</span> <span class="n">value2</span><span class="p">:</span>
        <span class="n">copy</span> <span class="o">=</span> <span class="n">value1</span>
        <span class="n">value1</span> <span class="o">=</span> <span class="n">value2</span>
        <span class="n">value2</span> <span class="o">=</span> <span class="n">copy</span>
        <span class="c1"># sign = -1</span>
    <span class="n">diff1</span> <span class="o">=</span> <span class="n">value2</span><span class="o">-</span><span class="n">value1</span>
    <span class="n">diff2</span> <span class="o">=</span> <span class="n">value1</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">-</span><span class="n">value2</span>
    
    <span class="c1"># if abs(diff1) &lt;= abs(diff2):</span>
    <span class="c1">#     return sign*diff1</span>
    <span class="c1"># else:</span>
    <span class="c1">#     return sign*diff2</span>
    <span class="k">return</span> <span class="n">diff1</span></div>


<div class="viewcode-block" id="Get_Directionality_Uncertainity">
<a class="viewcode-back" href="../../snom_analysis.html#snom_analysis.chiralcouplers.Get_Directionality_Uncertainity">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">Get_Directionality_Uncertainity</span><span class="p">(</span><span class="n">high_amp</span><span class="p">,</span> <span class="n">high_amp_uncert</span><span class="p">,</span> <span class="n">low_amp</span><span class="p">,</span> <span class="n">low_amp_uncert</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">high_amp</span><span class="p">)</span><span class="o">/</span><span class="p">((</span><span class="n">high_amp</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">low_amp</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">low_amp</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">high_amp_uncert</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">high_amp</span><span class="o">*</span><span class="n">low_amp</span><span class="o">*</span><span class="n">low_amp_uncert</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># simply gaussian error propagation</span></div>



<span class="c1"># unused?</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    def Fit_Decaying_Amplitude(self):</span>
<span class="sd">        with_oscillation = False</span>
<span class="sd">        root = tk.Tk()</span>
<span class="sd">        root.withdraw()</span>
<span class="sd">        filepath = filedialog.askopenfilename(initialdir=os.path.normpath(os.path.join(this_files_path, &#39;../chiralcouplers_analysis/extracted_data&#39;)))</span>
<span class="sd">        with open(filepath, &#39;r&#39;) as f:</span>
<span class="sd">            x = np.genfromtxt(f, delimiter=&#39;\t&#39;, skip_header=1, usecols=0)</span>
<span class="sd">        with open(filepath, &#39;r&#39;) as f:</span>
<span class="sd">            leftwg = np.genfromtxt(f, delimiter=&#39;\t&#39;, skip_header=1, usecols=1)</span>
<span class="sd">        with open(filepath, &#39;r&#39;) as f:</span>
<span class="sd">            rightwg = np.genfromtxt(f, delimiter=&#39;\t&#39;, skip_header=1, usecols=2)</span>
<span class="sd">            # data = np.loadtxt(f, delimiter=&#39;\t&#39;, skip_header=1)</span>
<span class="sd">        # print(&#39;x: &#39;, x)</span>
<span class="sd">        # print(&#39;leftwg: &#39;, leftwg)</span>
<span class="sd">        plt.plot(x*self.pixelsize*0.001,leftwg, label=&#39;leftwg&#39;, color=&#39;tab:blue&#39;) # convert pixels to distance in µm</span>
<span class="sd">        plt.plot(x*self.pixelsize*0.001,rightwg, label=&#39;rightwg&#39;, color=&#39;tab:orange&#39;)</span>
<span class="sd">        if with_oscillation == True:</span>
<span class="sd">            p0 = [0.2, 50, 0.1, 0.29, 0, 0.04]</span>
<span class="sd">            # bounds = ([0, -100], [100, 100])</span>
<span class="sd">            coeff_leftwg, var_matrix = curve_fit(Damped_Exponenial_Function, x, leftwg, p0=p0)</span>
<span class="sd">            coeff_rightwg, var_matrix = curve_fit(Damped_Exponenial_Function, x, leftwg, p0=p0)</span>
<span class="sd">            # plt.plot(x, Damped_Oscillation_Function(x, 0.1, 0.29, 0, 0.04)+Exponenial_Function(x, 0.2, 0.01, 0))</span>
<span class="sd">            # plt.plot(x, Damped_Exponenial_Function(x, 0.2, 50, 0.1, 0.29, 0, 0.04), label=&#39;initial_guess&#39;)</span>
<span class="sd">            plt.plot(x, Damped_Exponenial_Function(x, coeff_leftwg[0], coeff_leftwg[1], coeff_leftwg[2], coeff_leftwg[3], coeff_leftwg[4], coeff_leftwg[5], ), label=&#39;fit_leftwg&#39;, color=&#39;tab:blue&#39;)</span>
<span class="sd">            plt.plot(x, Damped_Exponenial_Function(x, coeff_rightwg[0], coeff_rightwg[1], coeff_rightwg[2], coeff_rightwg[3], coeff_rightwg[4], coeff_rightwg[5], ), label=&#39;fit_rightwg&#39;, color=&#39;tab:orange&#39;)</span>
<span class="sd">            print(&#39;oscillation period leftwg = &#39;, 2*np.pi/(np.sqrt(1-coeff_leftwg[5]**2 )*coeff_leftwg[3])*self.pixelsize, &#39; nm&#39;)</span>
<span class="sd">            print(&#39;oscillation period rightwg = &#39;, 2*np.pi/(np.sqrt(1-coeff_rightwg[5]**2 )*coeff_rightwg[3])*self.pixelsize, &#39; nm&#39;)</span>
<span class="sd">        else:</span>
<span class="sd">            p0 = [1, self.pixelsize]</span>
<span class="sd">            coeff_leftwg, var_matrix = curve_fit(Exponenial_Function, x, leftwg, p0=p0)</span>
<span class="sd">            coeff_rightwg, var_matrix = curve_fit(Exponenial_Function, x, rightwg, p0=p0)</span>
<span class="sd">            # plt.plot(x,leftwg, label=&#39;leftwg&#39;, color=&#39;tab:blue&#39;)</span>
<span class="sd">            # plt.plot(x,rightwg, label=&#39;rightwg&#39;, color=&#39;tab:orange&#39;)</span>
<span class="sd">            plt.plot(x*self.pixelsize*0.001, Exponenial_Function(x, coeff_leftwg[0], coeff_leftwg[1]), &#39;--&#39;, label=&#39;fit_leftwg&#39;, color=&#39;tab:blue&#39;)</span>
<span class="sd">            plt.plot(x*self.pixelsize*0.001, Exponenial_Function(x, coeff_rightwg[0], coeff_rightwg[1]), &#39;--&#39;, label=&#39;fit_rightwg&#39;, color=&#39;tab:orange&#39;)</span>
<span class="sd">        print(&#39;propagation length leftwg = &#39;, coeff_leftwg[1]*self.pixelsize, &#39; nm&#39;) </span>
<span class="sd">        print(&#39;propagation length rightwg = &#39;, coeff_rightwg[1]*self.pixelsize, &#39; nm&#39;) </span>
<span class="sd">        # print(coeff)</span>
<span class="sd">        plt.xlabel(&#39;$x \ [µm]$&#39;)</span>
<span class="sd">        plt.ylabel(&#39;$abs(E_z) \ [a.u.]$&#39;)</span>
<span class="sd">        plt.legend()</span>
<span class="sd">        plt.show()</span>

<span class="sd">    def Fit_Sawtooth(self, data):</span>
<span class="sd">        x = np.linspace(0, 1, len(data))</span>
<span class="sd">        n_periods=8</span>
<span class="sd">        period = len(data)/n_periods</span>
<span class="sd">        p0 = [n_periods, 0]</span>
<span class="sd">        bounds = ([1, -100], [100, 100])</span>
<span class="sd">        coeff, var_matrix = curve_fit(Sawtooth_v2, x, data, p0=p0, bounds=bounds)</span>
<span class="sd">        print(&#39;Fit of Sawtooth successful!&#39;)</span>
<span class="sd">        print(coeff)</span>
<span class="sd">        return coeff</span>


<span class="sd">    def Display_Phase_Profile(self, channel):</span>
<span class="sd">        if channel in self.channels:</span>
<span class="sd">            self._Plot_Data_With_Fit_And_Bounds(self.data_array[self.channels.index(channel)], channel)</span>
<span class="sd">        else:</span>
<span class="sd">            print(f&#39;This channel ({channel}) is not in memory!&#39;)</span>
<span class="sd">            exit()</span>
<span class="sd">        self.Extract_WG_Data(channel)</span>
<span class="sd">        self.phase_left_integ_array = []</span>
<span class="sd">        self.phase_right_integ_array = []</span>
<span class="sd">        for row in range(len(self.data_array[self.channels.index(channel)])):</span>
<span class="sd">            sum_left = 0</span>
<span class="sd">            sum_right = 0</span>
<span class="sd">            phase_left = self.left_wg_data[row]</span>
<span class="sd">            phase_right = self.right_wg_data[row]</span>
<span class="sd">            N = 2*self.integ_width</span>
<span class="sd">            for j in range(N):</span>
<span class="sd">                sum_left+=phase_left[j]</span>
<span class="sd">                sum_right+=phase_right[j]</span>
<span class="sd">            # print(&#39;sum_left:&#39;, sum_left)</span>
<span class="sd">            self.phase_left_integ_array.append(sum_left/(N))</span>
<span class="sd">            self.phase_right_integ_array.append(sum_right/(N))</span>
<span class="sd">        # print(&#39;len(data[0])&#39;, len(data[0]))</span>
<span class="sd">        # print(&#39;len(phase_left_integ_array)&#39;, len(phase_left_integ_array))</span>
<span class="sd">        # plt.plot(range(len(phase_left_integ_array)), phase_left_integ_array, label=&#39;left wg&#39;)</span>
<span class="sd">        plt.plot(range(len(self.phase_right_integ_array)), self.phase_right_integ_array, label=&#39;right wg&#39;)</span>
<span class="sd">        </span>
<span class="sd">        # coeff = self.Fit_Sawtooth(phase_right_integ_array)</span>
<span class="sd">        # x = range(len(phase_left_integ_array))</span>
<span class="sd">        # x = np.linspace(0, 1, 500)</span>
<span class="sd">        # plt.plot(x*len(phase_left_integ_array), Sawtooth_v2(x, coeff[0], coeff[1]), label=&#39;Fit to right wg&#39;)</span>
<span class="sd">        </span>
<span class="sd">        flattened_profile = Flatten_Profile(self.phase_right_integ_array)</span>
<span class="sd">        p0 = [1, 0]</span>
<span class="sd">        bounds = ([0, -100], [100, 100])</span>
<span class="sd">        coeff, pcov = Fit_Linear_Function(flattened_profile, p0, bounds)</span>
<span class="sd">        plt.plot(range(len(self.phase_right_integ_array)), flattened_profile, label=&#39;flattened phase&#39;)</span>
<span class="sd">        plt.plot(range(len(self.phase_right_integ_array)), Linear_Function(np.arange(len(self.phase_right_integ_array)), coeff[0], coeff[1]), label=&#39;fit: flattened phase&#39;)</span>
<span class="sd">        plt.title(f&#39;{channel}&#39;)</span>
<span class="sd">        plt.legend()</span>
<span class="sd">        plt.show()</span>

<span class="sd">    </span>

<span class="sd">    def Integrate_Amplitude(self, channel):</span>
<span class="sd">        if channel in self.channels:</span>
<span class="sd">            self._Plot_Data_With_Fit_And_Bounds(self.data_array[self.channels.index(channel)], channel)</span>
<span class="sd">        else:</span>
<span class="sd">            print(f&#39;This channel ({channel}) is not in memory!&#39;)</span>
<span class="sd">            exit()</span>
<span class="sd">        </span>
<span class="sd">        self.Extract_WG_Data(channel)</span>
<span class="sd">        self.amp_left_integ_array = []</span>
<span class="sd">        self.amp_right_integ_array = []</span>
<span class="sd">        for row in range(len(self.data_array[self.channels.index(channel)])):</span>
<span class="sd">            sum_left = 0</span>
<span class="sd">            sum_right = 0</span>
<span class="sd">            amp_left = self.left_wg_data[row]</span>
<span class="sd">            amp_right = self.right_wg_data[row]</span>
<span class="sd">            for j in range(2*self.integ_width):</span>
<span class="sd">                sum_left+=amp_left[j]</span>
<span class="sd">                sum_right+=amp_right[j]</span>
<span class="sd">            # print(&#39;sum_left:&#39;, sum_left)</span>
<span class="sd">            self.amp_left_integ_array.append(sum_left)</span>
<span class="sd">            self.amp_right_integ_array.append(sum_right)</span>
<span class="sd">        # print(&#39;len(data[0])&#39;, len(data[0]))</span>
<span class="sd">        # print(&#39;len(self.amp_left_integ_array)&#39;, len(self.amp_left_integ_array))</span>
<span class="sd">        plt.plot(range(len(self.amp_left_integ_array)), self.amp_left_integ_array, label=&#39;left wg&#39;)</span>
<span class="sd">        plt.plot(range(len(self.amp_right_integ_array)), self.amp_right_integ_array, label=&#39;right wg&#39;)</span>
<span class="sd">        plt.title(f&#39;{channel}&#39;)</span>
<span class="sd">        plt.legend()</span>
<span class="sd">        plt.show()</span>


<span class="sd">    def Export_Data(self, channel, filename, left_data=None, right_data=None):</span>
<span class="sd">        filepath = os.path.normpath(os.path.join(this_files_path, &#39;../chiralcouplers_analysis/extracted_data&#39;))</span>
<span class="sd">        if &#39;A&#39; in channel:</span>
<span class="sd">            if left_data==None:</span>
<span class="sd">                left_data = self.amp_left_integ_array</span>
<span class="sd">            if right_data==None:</span>
<span class="sd">                right_data = self.amp_right_integ_array</span>
<span class="sd">            filename_extension = f&#39;{channel}_mean.txt&#39;</span>
<span class="sd">            with open(filepath + &#39;/&#39; + filename + filename_extension, &#39;w&#39;) as datafile:</span>
<span class="sd">                datafile.write(&#39;#pixel\tamp leftwg\tamp rightwg\n&#39;)</span>
<span class="sd">                for i in range(len(self.amp_left_integ_array)):</span>
<span class="sd">                    datafile.write(f&#39;{i}\t{round(self.amp_left_integ_array[i], 3)}\t{round(self.amp_right_integ_array[i], 3)}\n&#39;)</span>
<span class="sd">            # with open(filepath + &#39;/&#39; + f&#39;right_wg_integ_{channel}.txt&#39;, &#39;w&#39;) as datafile:</span>
<span class="sd">            #     datafile.write(&#39;#pixel\tamp&#39;)</span>
<span class="sd">            #     for i in range(len(self.amp_right_integ_array)):</span>
<span class="sd">            #         datafile.write(f&#39;{i}\t{self.amp_right_integ_array[i]}\n&#39;)</span>
<span class="sd">        elif &#39;P&#39; in channel:</span>
<span class="sd">            if left_data==None:</span>
<span class="sd">                left_data = self.phase_left_integ_array</span>
<span class="sd">            if right_data==None:</span>
<span class="sd">                right_data = self.phase_right_integ_array</span>
<span class="sd">            filename_extension = f&#39;{channel}_mean.txt&#39;</span>
<span class="sd">            with open(filepath + &#39;/&#39; + filename + filename_extension, &#39;w&#39;) as datafile:</span>
<span class="sd">                datafile.write(&#39;#pixel\tphase leftwg\tphase rightwg&#39;)</span>
<span class="sd">                for i in range(len(self.phase_left_integ_array)):</span>
<span class="sd">                    datafile.write(f&#39;{i}\t{round(self.phase_left_integ_array[i], 3)}\t{round(self.phase_right_integ_array[i], 3)}\n&#39;)</span>
<span class="sd">            # with open(filepath + &#39;/&#39; + f&#39;right_wg_integ_{channel}.txt&#39;, &#39;w&#39;) as datafile:</span>
<span class="sd">            #     datafile.write(&#39;#pixel\tamp&#39;)</span>
<span class="sd">            #     for i in range(len(self.phase_right_integ_array)):</span>
<span class="sd">            #         datafile.write(f&#39;{i}\t{self.amp_right_integ_array[i]}\n&#39;)</span>

<span class="sd">    def Export_Mean_Data(self, filename):</span>
<span class="sd">        self._Data_Mean()</span>
<span class="sd">        for i in range(len(self.mean_data)):</span>
<span class="sd">            channel = self.mean_data[i][0]</span>
<span class="sd">            self.Export_Data(channel, filename, self.mean_data[i][1], self.mean_data[i][2])</span>
<span class="sd">    </span>
<span class="sd">    def Export_Mean_Data_with_Errors(self, filename):</span>
<span class="sd">        self._Data_Mean_with_Errors()</span>
<span class="sd">        for i in range(len(self.channels)):</span>
<span class="sd">            channel = self.mean_data[i][0]</span>
<span class="sd">            self.Export_Data(channel, filename, self.mean_data[i][1], self.mean_data[i][2])</span>

<span class="sd">    def Load_Extracted_Data(self):</span>
<span class="sd">        root = tk.Tk()</span>
<span class="sd">        root.withdraw()</span>
<span class="sd">        filepath = filedialog.askopenfilename(initialdir=os.path.normpath(os.path.join(this_files_path, &#39;../chiralcouplers_analysis/extracted_data&#39;)))</span>
<span class="sd">        datafile = open(filepath, &#39;r&#39;)</span>
<span class="sd">        self.amplitude_left = np.genfromtxt(datafile, delimiter=&#39;\t&#39;, skip_header=2, usecols=1)</span>
<span class="sd">        datafile.close()</span>
<span class="sd">        datafile = open(filepath, &#39;r&#39;)</span>
<span class="sd">        self.amplitude_right = np.genfromtxt(datafile, delimiter=&#39;\t&#39;, skip_header=2, usecols=2)</span>
<span class="sd">        datafile.close()</span>
<span class="sd">        datafile = open(filepath, &#39;r&#39;)</span>
<span class="sd">        self.phase_left = np.genfromtxt(datafile, delimiter=&#39;\t&#39;, skip_header=2, usecols=3)</span>
<span class="sd">        datafile.close()</span>
<span class="sd">        datafile = open(filepath, &#39;r&#39;)</span>
<span class="sd">        self.phase_right = np.genfromtxt(datafile, delimiter=&#39;\t&#39;, skip_header=2, usecols=4)</span>
<span class="sd">        datafile.close()</span>

<span class="sd">    # should be included as external functionality, plot profiles, </span>
<span class="sd">    def Display_Phase_Difference(self, channel):</span>
<span class="sd">        if channel in self.channels:</span>
<span class="sd">            self._Plot_Data_With_Fit_And_Bounds(self.data_array[self.channels.index(channel)], channel)</span>
<span class="sd">        else:</span>
<span class="sd">            print(f&#39;This channel ({channel}) is not in memory!&#39;)</span>
<span class="sd">            exit()</span>
<span class="sd">        self.Extract_WG_Data(channel)</span>
<span class="sd">        phase_left_integ_array = []</span>
<span class="sd">        phase_right_integ_array = []</span>
<span class="sd">        phase_difference = []</span>
<span class="sd">        for row in range(len(self.left_wg_data)):</span>
<span class="sd">            sum_left = 0</span>
<span class="sd">            sum_right = 0</span>
<span class="sd">            phase_left = self.left_wg_data[row]</span>
<span class="sd">            phase_right = self.right_wg_data[row]</span>
<span class="sd">            N = 2*self.integ_width</span>
<span class="sd">            for j in range(N):</span>
<span class="sd">                sum_left+=phase_left[j]</span>
<span class="sd">                sum_right+=phase_right[j]</span>
<span class="sd">            # print(&#39;sum_left:&#39;, sum_left)</span>
<span class="sd">            phase_left_integ_array.append(sum_left/(N))</span>
<span class="sd">            phase_right_integ_array.append(sum_right/(N))</span>
<span class="sd">            # phase_difference.append(Get_Smallest_Difference(sum_left/(N), sum_right/(N)))</span>
<span class="sd">            phase_difference.append(Get_Phase_Difference_V2(sum_left/(N), sum_right/(N)))</span>

<span class="sd">        # extend the phase range by adding copy shifted down by 2 pi</span>
<span class="sd">        extended_phase_difference = []</span>
<span class="sd">        for phase in phase_difference:</span>
<span class="sd">            extended_phase_difference.append(phase)</span>
<span class="sd">            if phase &gt;= np.pi:</span>
<span class="sd">                extended_phase_difference.append(phase- 2*np.pi)</span>
<span class="sd">        plt.plot(range(len(phase_difference)), phase_difference, &#39;x&#39;, label=&#39;phase difference&#39;)</span>
<span class="sd">        plt.title(f&#39;{channel}&#39;)</span>
<span class="sd">        plt.legend()</span>
<span class="sd">        plt.show()</span>

<span class="sd">&#39;&#39;&#39;</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Hans-Joachim Schill.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>